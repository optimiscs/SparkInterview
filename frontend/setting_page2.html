<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>智能面试助手 - 简历解析</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#3b82f6',
secondary: '#6366f1'
},
borderRadius: {
'none': '0px',
'sm': '4px',
DEFAULT: '8px',
'md': '12px',
'lg': '16px',
'xl': '20px',
'2xl': '24px',
'3xl': '32px',
'full': '9999px',
'button': '8px'
}
}
}
}
</script>
<style>
:where([class^="ri-"])::before {
content: "\f3c2";
}
.progress-bar {
transition: width 0.3s ease;
}
.fade-in {
animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
.skill-tag {
transition: all 0.2s ease;
}
.skill-tag:hover {
transform: translateY(-1px);
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
</head>
<body class="bg-gray-50 min-h-screen">
<div class="flex h-screen flex-col">
<!-- 导航栏容器 - 组件会自动插入到这里 -->
    <div id="navbar-container"></div>
<!-- 主要内容区 -->
<div class="flex-1 flex overflow-hidden bg-gray-50">
<!-- 左侧主要内容区 -->
<div class="flex-1 flex flex-col overflow-hidden">
<div class="bg-white border-b border-gray-200 px-8 py-6">
<h1 class="text-2xl font-bold text-gray-900">简历解析</h1>
<p class="text-gray-600 mt-1">系统正在调用Spark Pro智能解析您的简历，提取关键信息和技能点</p>
</div>
<!-- 进度指示器 -->
<div class="bg-white border-b border-gray-200 px-8 py-4">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
<i class="ri-check-line"></i>
</div>
<span class="ml-2 text-sm font-medium text-green-600">基础信息</span>
</div>
<div class="flex-1 mx-4 h-px bg-green-300"></div>
<div class="flex items-center">
<div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-medium">2</div>
<span class="ml-2 text-sm font-medium text-primary">简历解析</span>
</div>
<div class="flex-1 mx-4 h-px bg-gray-300"></div>
<div class="flex items-center">
<div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 text-sm font-medium">3</div>
<span class="ml-2 text-sm text-gray-500">题目生成</span>
</div>
</div>
</div>
<div class="flex-1 flex overflow-hidden">
<!-- 简历预览区 -->
<div class="flex-1 p-8 overflow-y-auto">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 h-full">
<div class="p-6 border-b border-gray-200 flex items-center justify-between">
<h3 class="text-lg font-semibold text-gray-900">简历预览</h3>
<div class="flex items-center space-x-2">
<button class="p-2 text-gray-400 hover:text-gray-600">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-zoom-out-line"></i>
</div>
</button>
<span class="text-sm text-gray-500">100%</span>
<button class="p-2 text-gray-400 hover:text-gray-600">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-zoom-in-line"></i>
</div>
</button>
</div>
</div>
<div class="p-6 flex-1 bg-gray-50">
<div class="bg-white rounded-lg shadow-sm p-8 max-w-2xl mx-auto" style="min-height: 800px;" id="resumePreview">
<div class="text-center mb-8">
<h1 class="text-3xl font-bold text-gray-900 mb-2" id="resumeName">莫栩</h1>
<p class="text-lg text-gray-600 mb-4" id="resumePosition">算法工程师</p>
<div class="flex justify-center space-x-6 text-sm text-gray-600">
<div class="flex items-center" id="resumePhone">
<i class="ri-phone-line mr-1"></i>
13480805647
</div>
<div class="flex items-center" id="resumeEmail">
<i class="ri-mail-line mr-1"></i>
2022302181277@whu.edu.cn
</div>
<div class="flex items-center" id="resumeCity">
<i class="ri-map-pin-line mr-1"></i>
武汉市
</div>
</div>
</div>
<div class="space-y-8">
<div>
<h2 class="text-xl font-semibold text-gray-900 mb-4 border-b-2 border-primary pb-2">工作经历</h2>
<div class="space-y-6" id="resumeExperience">
<div>
<div class="flex justify-between items-start mb-2">
<h3 class="text-lg font-medium text-gray-900">武汉大学 - 学生</h3>
<span class="text-sm text-gray-600">2022.09 - 2026.06</span>
</div>
<ul class="text-gray-700 space-y-1 ml-4">
<li>• 大模型微调的安全对齐研究</li>
<li>• 舆情分析系统开发</li>
<li>• 创新发明与知识产权协会副会长</li>
</ul>
</div>
<div>
<div class="flex justify-between items-start mb-2">
<h3 class="text-lg font-medium text-gray-900">电商电群 - 创业者</h3>
<span class="text-sm text-gray-600">2023.06 - 至今</span>
</div>
<ul class="text-gray-700 space-y-1 ml-4">
<li>• 团队管理：组建9人跨职能团队</li>
<li>• 效率优化：引入智能发货机器人</li>
<li>• 规模拓展：运营七个店铺，服务超二十万用户</li>
</ul>
</div>
</div>
</div>
<div>
<h2 class="text-xl font-semibold text-gray-900 mb-4 border-b-2 border-primary pb-2">项目经验</h2>
<div class="space-y-4" id="resumeProjects">
<div>
<h3 class="text-lg font-medium text-gray-900 mb-2">大模型微调的安全对齐研究</h3>
<p class="text-gray-700 mb-2">成功复现ICLR的关键结论，采用GPT-4o对目标大语言模型输出进行精细化安全性量化评估</p>
<p class="text-sm text-gray-600">技术栈：Python, PyTorch, GPT-4o, 安全评估</p>
</div>
<div>
<h3 class="text-lg font-medium text-gray-900 mb-2">舆情分析系统</h3>
<p class="text-gray-700 mb-2">前后端分离架构，支持实时情感分析和热点事件检测</p>
<p class="text-sm text-gray-600">技术栈：React, FastAPI, Redis, MongoDB, Docker</p>
</div>
<div>
<h3 class="text-lg font-medium text-gray-900 mb-2">电商电群运营</h3>
<p class="text-gray-700 mb-2">从零开始孵化并运营七个店铺，形成店群效应，C端营收突破百万</p>
<p class="text-sm text-gray-600">技术栈：团队管理, 自动化系统, 数据分析</p>
</div>
</div>
</div>
<div>
<h2 class="text-xl font-semibold text-gray-900 mb-4 border-b-2 border-primary pb-2">技能专长</h2>
<div class="grid grid-cols-2 gap-4" id="resumeSkills">
<div>
<h4 class="font-medium text-gray-900 mb-2">编程语言</h4>
<p class="text-gray-700">Python, JavaScript, Java</p>
</div>
<div>
<h4 class="font-medium text-gray-900 mb-2">框架工具</h4>
<p class="text-gray-700">PyTorch, Springboot, React, FastAPI</p>
</div>
<div>
<h4 class="font-medium text-gray-900 mb-2">数据库</h4>
<p class="text-gray-700">Redis, MongoDB, MySQL</p>
</div>
<div>
<h4 class="font-medium text-gray-900 mb-2">其他工具</h4>
<p class="text-gray-700">Docker, Git, Linux</p>
</div>
</div>
</div>
<div>
<h2 class="text-xl font-semibold text-gray-900 mb-4 border-b-2 border-primary pb-2">教育背景</h2>
<div>
<div class="flex justify-between items-start mb-2">
<h3 class="text-lg font-medium text-gray-900">武汉大学 - 网络空间安全</h3>
<span class="text-sm text-gray-600">2022.09 - 2026.06</span>
</div>
<p class="text-gray-700">本科 | GPA: 3.72/4.0</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- 解析进度区 -->
<div class="w-96 bg-white border-l border-gray-200 p-6 overflow-y-auto">
<h3 class="text-lg font-semibold text-gray-900 mb-6">解析进度</h3>
<!-- 总体进度 -->
<div class="mb-8">
<div class="flex items-center justify-between mb-2">
<span class="text-sm font-medium text-gray-700">整体进度</span>
<span class="text-sm text-primary font-medium" id="overallProgress">100%</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-2">
<div class="bg-primary h-2 rounded-full progress-bar" id="overallBar" style="width: 100%"></div>
</div>
</div>
<!-- 各模块进度 -->
<div class="space-y-6">
<div class="fade-in">
<div class="flex items-center mb-3">
<div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3">
<i class="ri-check-line text-white text-sm"></i>
</div>
<h4 class="text-sm font-medium text-gray-900">基本信息提取</h4>
</div>
<div class="ml-9 text-xs text-gray-600 space-y-1" id="basicInfoDetails">
<p>✓ 姓名：莫栩</p>
<p>✓ 联系方式：已提取</p>
<p>✓ 工作年限：2 年</p>
</div>
</div>
<div class="fade-in">
<div class="flex items-center mb-3">
<div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3">
<i class="ri-check-line text-white text-sm"></i>
</div>
<h4 class="text-sm font-medium text-gray-900">技能点识别</h4>
</div>
<div class="ml-9" id="skillsDetails">
<div class="flex flex-wrap gap-1 mb-2" id="skillsTags">
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">Python</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">PyTorch</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">Springboot</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">React</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">Docker</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">FastAPI</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">Redis</span>
<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag">MongoDB</span>
</div>
<p class="text-xs text-gray-600" id="skillsCount">已识别 8 个核心技能</p>
</div>
</div>
<div class="fade-in">
<div class="flex items-center mb-3">
<div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3">
<i class="ri-check-line text-white text-sm"></i>
</div>
<h4 class="text-sm font-medium text-gray-900">项目经验提取</h4>
</div>
<div class="ml-9 space-y-3" id="projectsDetails">
<div class="bg-gray-50 rounded-lg p-3">
<h5 class="text-sm font-medium text-gray-900">大模型微调的安全对齐研究</h5>
<p class="text-xs text-gray-600 mt-1">AI安全 • 模型微调 • 安全评估</p>
<div class="flex items-center mt-2 text-xs text-green-600">
<i class="ri-time-line mr-1"></i>
2025.03 - 至今
</div>
</div>
<div class="bg-gray-50 rounded-lg p-3">
<h5 class="text-sm font-medium text-gray-900">舆情分析系统</h5>
<p class="text-xs text-gray-600 mt-1">前后端分离 • 情感分析 • 实时检测</p>
<div class="flex items-center mt-2 text-xs text-green-600">
<i class="ri-time-line mr-1"></i>
2024.11 - 至今
</div>
</div>
<div class="bg-gray-50 rounded-lg p-3">
<h5 class="text-sm font-medium text-gray-900">电商电群运营</h5>
<p class="text-xs text-gray-600 mt-1">团队管理 • 自动化系统 • 数据分析</p>
<div class="flex items-center mt-2 text-xs text-green-600">
<i class="ri-time-line mr-1"></i>
2023.06 - 至今
</div>
</div>
</div>
</div>
<div class="fade-in">
<div class="flex items-center mb-3">
<div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3">
<i class="ri-check-line text-white text-sm"></i>
</div>
<h4 class="text-sm font-medium text-gray-900">工作经历分析</h4>
</div>
<div class="ml-9 space-y-3">
<div class="border-l-2 border-primary pl-4">
<div class="flex items-center justify-between mb-1">
<h5 class="text-sm font-medium text-gray-900">百度</h5>
<span class="text-xs text-gray-500">2021.03 - 至今</span>
</div>
<p class="text-xs text-gray-600 mb-2">高级算法工程师</p>
<div class="space-y-1 text-xs text-gray-600">
<p>• 推荐系统算法优化</p>
<p>• 深度学习模型研发</p>
<p>• 机器学习平台架构</p>
</div>
</div>
<div class="border-l-2 border-gray-300 pl-4">
<div class="flex items-center justify-between mb-1">
<h5 class="text-sm font-medium text-gray-900">腾讯</h5>
<span class="text-xs text-gray-500">2019.07 - 2021.02</span>
</div>
<p class="text-xs text-gray-600 mb-2">算法工程师</p>
<div class="space-y-1 text-xs text-gray-600">
<p>• 协同过滤算法开发</p>
<p>• 模型训练优化</p>
<p>• A/B 测试平台</p>
</div>
</div>
</div>
</div>
</div>
<!-- 解析结果摘要 -->
<div class="mt-8 bg-green-50 rounded-lg p-4">
<div class="flex items-center mb-3">
<div class="w-5 h-5 flex items-center justify-center mr-2">
<i class="ri-check-double-line text-green-600"></i>
</div>
<h4 class="text-sm font-medium text-green-900">解析完成</h4>
</div>
<div class="text-xs text-green-700 space-y-1">
<p>• 识别技能点：15 个</p>
<p>• 提取项目经验：3 个</p>
<p>• 分析工作经历：2 段</p>
<p>• 匹配度评分：92%</p>
</div>
</div>
<!-- 操作按钮 -->
<div class="flex flex-col space-y-3 mt-8">
<button class="w-full px-4 py-2 text-primary border border-primary rounded-button hover:bg-primary/5 whitespace-nowrap !rounded-button" id="reAnalyze">
<div class="w-4 h-4 flex items-center justify-center mr-2 inline-block">
<i class="ri-refresh-line"></i>
</div>
重新解析
</button>
<button class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-button hover:bg-gray-50 whitespace-nowrap !rounded-button" id="exportResult">
<div class="w-4 h-4 flex items-center justify-center mr-2 inline-block">
<i class="ri-download-line"></i>
</div>
导出结果
</button>

<button class="w-full px-4 py-3 bg-primary text-white rounded-button hover:bg-primary/90 whitespace-nowrap !rounded-button" id="nextStep">
<div class="w-4 h-4 flex items-center justify-center mr-2 inline-block">
<i class="ri-arrow-right-line"></i>
</div>
下一步：生成题目
</button>

</div>
</div>
</div>
</div>
</div>
<script id="analysis-loader">
// 统一的分析结果加载器
const AnalysisLoader = {
  // 初始化
  async init() {
    // 检查登录状态
    const token = localStorage.getItem('access_token');
    if (!token) {
      window.location.href = '/frontend/login.html';
      return;
    }

    // 获取用户信息
    await this.fetchUserInfo();
    
    // 获取分析结果
    await this.loadAnalysisResult();
  },

  // 获取用户信息
  async fetchUserInfo() {
    const token = localStorage.getItem('access_token');
    if (!token) return;
    
    try {
      const resp = await fetch('/api/v1/profile', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      
      if (!resp.ok) throw new Error('获取用户信息失败');
      
      const user = await resp.json();
      this.renderUserInfo(user);
    } catch (error) {
      console.error('获取用户信息失败:', error);
      localStorage.removeItem('access_token');
      window.location.href = '/frontend/login.html';
    }
  },

  // 渲染用户信息
  renderUserInfo(user) {
    const userInfoDiv = document.querySelector('.flex.items-center:last-child');
    if (userInfoDiv && user) {
      userInfoDiv.innerHTML = `
        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center overflow-hidden">
          ${user.avatar_url ? 
            `<img src="${user.avatar_url}" class="w-full h-full object-cover" alt="头像">` : 
            `<i class="ri-user-line text-white"></i>`}
        </div>
        <div class="ml-2">
          <p class="text-sm font-medium text-gray-900">${user.name || '未知用户'}</p>
          <p class="text-xs text-gray-500">${user.role === 'admin' ? '管理员' : user.role === 'teacher' ? '教师' : '学生'}</p>
        </div>
      `;
    }
  },

  // 加载分析结果
  async loadAnalysisResult() {
    // 从URL参数获取taskId
const urlParams = new URLSearchParams(window.location.search);
const taskId = urlParams.get('taskId');

    if (!taskId) {
      this.showError('缺少任务ID参数，请从简历配置页面重新开始');
      return;
}

    console.log('🔍 开始获取分析结果，TaskID:', taskId);
    
    try {
      // 检查是否是测试模式（taskId以test_开头）
      if (taskId.startsWith('test_task_')) {
        console.log('🧪 检测到测试模式，尝试从localStorage获取模拟数据');
        const mockData = localStorage.getItem('mock_analysis_' + taskId);
        
        if (mockData) {
          const result = JSON.parse(mockData);
          console.log('📊 成功获取测试数据:', result);
          this.displayAnalysisResults(result);
          return;
} else {
          throw new Error('测试数据不存在，请先运行测试工具创建模拟数据');
}
      }

      // 正常模式：调用后端API
      console.log('🌐 正常模式，调用后端API获取分析结果');
      const statusResp = await fetch(`/api/v1/resume/status/${taskId}`);
      
      if (!statusResp.ok) {
        throw new Error(`HTTP错误: ${statusResp.status} ${statusResp.statusText}`);
}
      
      const statusData = await statusResp.json();

      if (!statusData.success) {
        throw new Error(statusData.error || '获取任务状态失败');
      }

      if (statusData.status !== 'completed') {
        this.showError(`任务未完成，当前状态：${statusData.status}`);
return;
}

      // 获取分析结果
      console.log('✅ 任务已完成，开始获取分析结果');
      const result = statusData.result;
      
      if (result) {
        console.log('📊 成功获取分析结果:', result);
        this.displayAnalysisResults(result);
} else {
        throw new Error('分析结果为空');
}

    } catch (error) {
      console.error('❌ 获取分析结果失败:', error);
      this.showError('获取分析结果失败: ' + error.message + '。如果是测试模式，请确保先运行测试工具创建模拟数据。');
}
  },

  // 显示分析结果
  displayAnalysisResults(data) {
    console.log('🎨 开始渲染分析结果');
    
    // 更新基本信息
    if (data.basic_info) {
      this.updateResumePreview(data.basic_info);
      this.updateBasicInfoDetails(data.basic_info);  // 🆕 更新右侧基本信息提取区域
}

    // 更新工作经历
if (data.experience && data.experience.length > 0) {
      this.updateResumeExperience(data.experience);
      this.updateWorkExperienceDetails(data.experience);  // 🆕 更新右侧工作经历分析区域
}

    // 更新项目经验
if (data.projects && data.projects.length > 0) {
      this.updateResumeProjects(data.projects);
      this.updateProjectsDetails(data.projects);  // 保持原有功能
}

    // 更新教育背景
    if (data.education) {
      this.updateResumeEducation(data.education);
    }

    // 更新技能分类
if (data.skills_categories) {
      this.updateResumeSkills(data.skills_categories);
}

    // 更新右侧技能点显示
    if (data.skills && data.skills.length > 0) {
      this.updateSkillsTags(data.skills);
    }

    // 更新分析摘要
    if (data.analysis) {
      this.updateAnalysisSummary(data.analysis, data);  // 🆕 传入完整数据用于统计
}

    // 显示完成状态
    this.showCompletedStatus();
  },

  // 更新简历预览
  updateResumePreview(basicInfo) {
const nameElement = document.getElementById('resumeName');
if (nameElement && basicInfo.name) {
nameElement.textContent = basicInfo.name;
}

const positionElement = document.getElementById('resumePosition');
if (positionElement && basicInfo.current_position) {
positionElement.textContent = basicInfo.current_position;
}

const phoneElement = document.getElementById('resumePhone');
if (phoneElement && basicInfo.phone) {
phoneElement.innerHTML = `<i class="ri-phone-line mr-1"></i>${basicInfo.phone}`;
}

const emailElement = document.getElementById('resumeEmail');
if (emailElement && basicInfo.email) {
emailElement.innerHTML = `<i class="ri-mail-line mr-1"></i>${basicInfo.email}`;
}

const cityElement = document.getElementById('resumeCity');
if (cityElement && basicInfo.city) {
cityElement.innerHTML = `<i class="ri-map-pin-line mr-1"></i>${basicInfo.city}`;
}
  },

  // 更新工作经历
  updateResumeExperience(experience) {
const experienceContainer = document.getElementById('resumeExperience');
if (experienceContainer && experience && experience.length > 0) {
experienceContainer.innerHTML = '';
experience.forEach(exp => {
const expDiv = document.createElement('div');
expDiv.innerHTML = `
<div class="flex justify-between items-start mb-2">
<h3 class="text-lg font-medium text-gray-900">${exp.company} - ${exp.position}</h3>
<span class="text-sm text-gray-600">${exp.period}</span>
</div>
<ul class="text-gray-700 space-y-1 ml-4">
${exp.responsibilities.map(resp => `<li>• ${resp}</li>`).join('')}
</ul>
`;
experienceContainer.appendChild(expDiv);
});
}
  },

  // 更新项目经验
  updateResumeProjects(projects) {
const projectsContainer = document.getElementById('resumeProjects');
if (projectsContainer && projects && projects.length > 0) {
projectsContainer.innerHTML = '';
projects.forEach(project => {
const projectDiv = document.createElement('div');
projectDiv.innerHTML = `
<h3 class="text-lg font-medium text-gray-900 mb-2">${project.name}</h3>
<p class="text-gray-700 mb-2">${project.description}</p>
<p class="text-sm text-gray-600">技术栈：${project.tech_stack}</p>
`;
projectsContainer.appendChild(projectDiv);
});
}
  },

  // 更新教育背景
  updateResumeEducation(education) {
    const educationContainer = document.querySelector('#resumePreview .space-y-8 > div:last-child');
    if (educationContainer && education) {
      educationContainer.innerHTML = `
        <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b-2 border-primary pb-2">教育背景</h2>
        <div>
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-lg font-medium text-gray-900">${education.school} - ${education.major}</h3>
            <span class="text-sm text-gray-600">${education.graduation_year}</span>
          </div>
          <p class="text-gray-700">${education.degree}${education.gpa ? ` | GPA: ${education.gpa}` : ''}</p>
        </div>
      `;
    }
  },

  // 更新技能分类
  updateResumeSkills(skillsCategories) {
const skillsContainer = document.getElementById('resumeSkills');
if (skillsContainer && skillsCategories) {
const skillSections = [
{ title: '编程语言', skills: skillsCategories.programming_languages || [] },
{ title: '框架工具', skills: skillsCategories.frameworks || [] },
{ title: '数据库', skills: skillsCategories.databases || [] },
{ title: '其他工具', skills: skillsCategories.tools || [] }
];

skillsContainer.innerHTML = '';
skillSections.forEach(section => {
if (section.skills.length > 0) {
const sectionDiv = document.createElement('div');
sectionDiv.innerHTML = `
<h4 class="font-medium text-gray-900 mb-2">${section.title}</h4>
<p class="text-gray-700">${section.skills.join(', ')}</p>
`;
skillsContainer.appendChild(sectionDiv);
}
});
}
  },

  // 更新右侧技能标签
  updateSkillsTags(skills) {
    const skillsContainer = document.getElementById('skillsTags');
    if (skillsContainer) {
      skillsContainer.innerHTML = '';
      skills.slice(0, 10).forEach(skill => { // 最多显示10个技能
const skillTag = document.createElement('span');
skillTag.className = 'px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded skill-tag';
skillTag.textContent = skill;
        skillsContainer.appendChild(skillTag);
      });
      
      // 更新技能数量
const skillsCount = document.getElementById('skillsCount');
if (skillsCount) {
        skillsCount.textContent = `已识别 ${skills.length} 个核心技能`;
}
}
  },

  // 更新右侧项目详情
  updateProjectsDetails(projects) {
    const projectsContainer = document.getElementById('projectsDetails');
    if (projectsContainer) {
      projectsContainer.innerHTML = '';
      projects.forEach(project => {
const projectDiv = document.createElement('div');
projectDiv.className = 'bg-gray-50 rounded-lg p-3';
projectDiv.innerHTML = `
<h5 class="text-sm font-medium text-gray-900">${project.name}</h5>
          <p class="text-xs text-gray-600 mt-1">${project.description}</p>
<div class="flex items-center mt-2 text-xs text-green-600">
<i class="ri-time-line mr-1"></i>
${project.period || ''}
</div>
`;
        projectsContainer.appendChild(projectDiv);
});
}
  },

// 🆕 更新基本信息提取区域
  updateBasicInfoDetails(basicInfo) {
    const basicInfoContainer = document.getElementById('basicInfoDetails');
    if (basicInfoContainer && basicInfo) {
      basicInfoContainer.innerHTML = `
        <p>✓ 姓名：${basicInfo.name || '未识别'}</p>
        <p>✓ 联系方式：${basicInfo.phone && basicInfo.email ? '已提取' : '部分提取'}</p>
        <p>✓ 工作年限：${basicInfo.experience_years || '未识别'}</p>
        <p>✓ 当前职位：${basicInfo.current_position || '未识别'}</p>
        <p>✓ 所在城市：${basicInfo.city || '未识别'}</p>
      `;
    }
  },

  // 🆕 更新工作经历分析区域
  updateWorkExperienceDetails(experience) {
    const experienceContainer = document.querySelector('.ml-9.space-y-3');
    if (experienceContainer && experience && experience.length > 0) {
      experienceContainer.innerHTML = '';
      
      experience.forEach((exp, index) => {
        const expDiv = document.createElement('div');
        expDiv.className = index === 0 ? 'border-l-2 border-primary pl-4' : 'border-l-2 border-gray-300 pl-4';
        
        expDiv.innerHTML = `
          <div class="flex items-center justify-between mb-1">
            <h5 class="text-sm font-medium text-gray-900">${exp.company}</h5>
            <span class="text-xs text-gray-500">${exp.period}</span>
          </div>
          <p class="text-xs text-gray-600 mb-2">${exp.position}</p>
          <div class="space-y-1 text-xs text-gray-600">
            ${exp.responsibilities.map(resp => `<p>• ${resp}</p>`).join('')}
          </div>
        `;
        
        experienceContainer.appendChild(expDiv);
      });
    }
  },

// 🆕 更新分析摘要（增强版）
  updateAnalysisSummary(analysis, fullData) {
    const summaryContainer = document.querySelector('.bg-green-50.rounded-lg');
    if (summaryContainer && analysis && fullData) {
      const detailsList = summaryContainer.querySelector('.space-y-1');
      if (detailsList) {
        // 计算真实统计数据
        const skillsCount = fullData.skills ? fullData.skills.length : 0;
        const projectsCount = fullData.projects ? fullData.projects.length : 0;
        const experienceCount = fullData.experience ? fullData.experience.length : 0;
        const overallMatch = analysis.overall_match || 0;
        
        detailsList.innerHTML = `
          <p>• 识别技能点：${skillsCount} 个</p>
          <p>• 提取项目经验：${projectsCount} 个</p>
          <p>• 分析工作经历：${experienceCount} 段</p>
          <p>• 匹配度评分：${overallMatch}%</p>
        `;
      }
    }
  },

  // 显示完成状态
  showCompletedStatus() {
    // 更新进度为100%
    const overallProgress = document.getElementById('overallProgress');
    const overallBar = document.getElementById('overallBar');
    
    if (overallProgress) overallProgress.textContent = '100%';
    if (overallBar) overallBar.style.width = '100%';

    console.log('✨ 分析结果渲染完成');
  },

  // 显示错误信息
  showError(message) {
    const errorDialog = document.createElement('div');
    errorDialog.className = 'fixed inset-0 flex items-center justify-center z-50';
    errorDialog.innerHTML = `
<div class="fixed inset-0 bg-black/50"></div>
<div class="relative bg-white rounded-lg p-6 max-w-sm w-full mx-4">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
            <i class="ri-error-warning-line text-red-600"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900">加载失败</h3>
        </div>
        <p class="text-gray-600 mb-4">${message}</p>
        <div class="flex space-x-3">
          <button class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-button hover:bg-gray-50" onclick="window.location.href='./setting_page1.html'">返回配置</button>
          <button class="flex-1 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90" onclick="location.reload()">重新加载</button>
        </div>
</div>
`;
    document.body.appendChild(errorDialog);
  }
};

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
  AnalysisLoader.init();
  
  // 🆕 初始化下一步按钮事件
  initNextStepButton();
});

// 🆕 初始化下一步按钮功能
function initNextStepButton() {
  const nextStepBtn = document.getElementById('nextStep');
  if (nextStepBtn) {
    nextStepBtn.addEventListener('click', handleNextStepClick);
  }
}

// 🆕 处理下一步按钮点击事件
function handleNextStepClick(e) {
  e.preventDefault();
  
  // 从URL参数获取taskId
  const urlParams = new URLSearchParams(window.location.search);
  const taskId = urlParams.get('taskId');
  
  console.log('🔍 下一步按钮被点击，TaskID:', taskId);
  
  if (!taskId) {
    showDialog('提示', '缺少任务ID，请从简历配置页面重新开始！');
    return;
  }
  
  // 构造跳转URL，带上taskId参数
  const nextPageUrl = `./setting_page3.html?taskId=${taskId}`;
  console.log('✅ 准备跳转到:', nextPageUrl);
  
  // 执行页面跳转
  window.location.href = nextPageUrl;
}

// 🆕 显示对话框的辅助函数
function showDialog(title, message) {
  const dialog = document.createElement('div');
  dialog.className = 'fixed inset-0 flex items-center justify-center z-50';
  dialog.innerHTML = `
    <div class="fixed inset-0 bg-black/50"></div>
    <div class="relative bg-white rounded-lg p-6 max-w-sm w-full mx-4">
      <h3 class="text-lg font-medium text-gray-900 mb-2">${title}</h3>
      <p class="text-gray-600 mb-4">${message}</p>
      <button class="w-full px-4 py-2 bg-primary text-white rounded-button" onclick="this.closest('.fixed').remove()">确定</button>
    </div>
  `;
  document.body.appendChild(dialog);
}


</script>

    <!-- 导入导航栏组件 -->
    <script src="./components/navbar.js"></script>
</body>
</html>