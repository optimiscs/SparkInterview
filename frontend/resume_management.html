<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>智能简历管理平台</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#3b82f6',
secondary: '#8b5cf6'
},
borderRadius: {
'none': '0px',
'sm': '4px',
DEFAULT: '8px',
'md': '12px',
'lg': '16px',
'xl': '20px',
'2xl': '24px',
'3xl': '32px',
'full': '9999px',
'button': '8px'
}
}
}
}
</script>
<style>
:where([class^="ri-"])::before {
content: "\f3c2";
}
</style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏容器 - 组件会自动插入到这里 -->
    <div id="navbar-container"></div>
<div class="flex h-[calc(100vh-64px)]">
<!-- 左侧导航栏 -->
<div class="w-64 bg-white shadow-lg flex flex-col">

<!-- 导航菜单 -->
<nav class="flex-1 p-4 pt-6">
<div class="space-y-2">
<div class="nav-item active bg-primary/10 text-primary rounded-lg p-3 cursor-pointer flex items-center space-x-3">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-brain-line"></i>
</div>
<span class="font-medium">智能分析与诊断</span>
</div>
<a href="./careerPlaning.html" class="nav-item text-gray-600 hover:bg-gray-50 rounded-lg p-3 cursor-pointer flex items-center space-x-3 transition-colors">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-roadmap-line"></i>
</div>
<span class="font-medium">职业发展规划</span>
</a>
</div>
<!-- 简历版本管理 -->
<div class="mt-8">
<h4 class="text-sm font-semibold text-gray-900 mb-3">我的简历版本</h4>
<div id="resumeVersionsList" class="space-y-2">
<!-- 加载状态 -->
<div id="resumeListLoading" class="text-center py-4">
<div class="w-6 h-6 bg-primary rounded-full animate-pulse mx-auto mb-2"></div>
<p class="text-xs text-gray-500">加载中...</p>
</div>
<!-- 空状态 -->
<div id="resumeListEmpty" class="hidden text-center py-8">
<div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
<i class="ri-file-text-line text-gray-400 text-xl"></i>
</div>
<p class="text-sm text-gray-500 mb-3">还没有创建简历版本</p>
<a href="./Resume_create.html" class="text-primary text-sm hover:text-primary/80">立即创建</a>
</div>
<!-- 错误状态 -->
<div id="resumeListError" class="hidden text-center py-4">
<div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-2">
<i class="ri-error-warning-line text-red-500"></i>
</div>
<p class="text-xs text-red-600 mb-2">加载失败</p>
<button id="retryLoadResumes" class="text-xs text-primary hover:text-primary/80">重试</button>
</div>
</div>
</div>
</nav>
<!-- 底部操作按钮 -->
<div class="p-4 border-t border-gray-100">
<a href="./Resume_create.html">
<button class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors whitespace-nowrap">
新建简历版本
</button>
</a>
</div>
</div>
<!-- 右侧主要内容区 -->
<div class="flex-1 flex flex-col">
<!-- 头部操作栏 -->
<div class="bg-white border-b border-gray-200 px-8 py-6">
<div class="flex items-center justify-between">
<div>
<h1 class="text-2xl font-bold text-gray-900">智能分析与诊断</h1>
<p class="text-gray-500 mt-1">基于 AI 的深度简历分析，助您打造完美简历</p>
</div>
<div class="flex items-center space-x-3">
<button id="uploadResumeBtn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 transition-colors whitespace-nowrap">
<div class="w-4 h-4 inline-flex items-center justify-center mr-2">
<i class="ri-upload-line"></i>
</div>
导入简历
</button>
<div id="uploadDialog" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
<div class="bg-white rounded-xl w-[480px] p-6">
<div class="flex items-center justify-between mb-4">
<h3 class="text-lg font-semibold text-gray-900">导入简历</h3>
<button id="closeUploadDialog" class="text-gray-400 hover:text-gray-600">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-close-line"></i>
</div>
</button>
</div>
<div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4 cursor-pointer hover:border-primary transition-colors">
<input type="file" id="fileInput" class="hidden" accept=".pdf,.doc,.docx">
<div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
<i class="ri-upload-cloud-line text-2xl text-primary"></i>
</div>
<p class="text-gray-900 font-medium mb-1">点击或拖拽文件到此处上传</p>
<p class="text-sm text-gray-500">支持 PDF、Word 格式文件</p>
</div>
<div id="uploadProgress" class="hidden">
<div class="flex items-center justify-between mb-2">
<span class="text-sm text-gray-700" id="fileName">文件名称.pdf</span>
<span class="text-sm text-gray-500" id="fileSize">2.5MB</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-2 mb-2">
<div id="progressBar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
</div>
<div class="flex items-center justify-between">
<span class="text-sm text-gray-500" id="uploadStatus">正在上传...</span>
<span class="text-sm text-primary" id="progressPercent">0%</span>
</div>
</div>
</div>
</div>
<button class="px-4 py-2 bg-secondary text-white rounded-button hover:bg-secondary/90 transition-colors whitespace-nowrap">
<div class="w-4 h-4 inline-flex items-center justify-center mr-2">
<i class="ri-download-line"></i>
</div>
导出 PDF
</button>
</div>
</div>
</div>
<!-- 主要内容区域 -->
<div class="flex-1 flex">
<!-- 简历预览区域 -->
<div class="flex-1 px-8 py-6">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 h-full">
<div class="p-6 border-b border-gray-100">
<h2 class="text-lg font-semibold text-gray-900">简历预览</h2>
</div>
<div class="p-6 h-full overflow-y-auto">
<!-- 简历内容容器 -->
<div id="resumeContentContainer" class="max-w-2xl mx-auto">
<!-- 加载状态 -->
<div id="resumePreviewLoading" class="text-center py-12">
<div class="w-12 h-12 bg-primary rounded-full animate-pulse mx-auto mb-4"></div>
<p class="text-gray-500">加载简历预览中...</p>
</div>

<!-- 空状态 -->
<div id="resumePreviewEmpty" class="hidden text-center py-12">
<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
<i class="ri-file-text-line text-gray-400 text-2xl"></i>
</div>
<p class="text-gray-500 mb-4">请选择一个简历版本进行预览</p>
<a href="./Resume_create.html" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 transition-colors">
创建新简历
</a>
</div>

<!-- 错误状态 -->
<div id="resumePreviewError" class="hidden text-center py-12">
<div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
<i class="ri-error-warning-line text-red-500 text-xl"></i>
</div>
<p class="text-red-600 mb-4">简历加载失败</p>
<button id="retryLoadResumeDetail" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 transition-colors">
重试
</button>
</div>

<!-- 动态简历内容 -->
<div id="resumePreviewContent" class="hidden bg-white">
<!-- 内容将通过 JavaScript 动态生成 -->
</div>
</div>
</div>
</div>
</div>
<!-- 智能分析面板 -->
<div class="w-80 px-6 py-6 bg-gray-50">
<div class="space-y-6">
<!-- JD 匹配分析 -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">JD 智能匹配分析</h3>
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">粘贴目标岗位 JD</label>
<textarea class="w-full h-24 p-3 border border-gray-300 rounded-lg text-sm resize-none" placeholder="请粘贴您心仪岗位的职位描述..."></textarea>
<button onclick="startJDAnalysis()" class="mt-2 w-full bg-primary text-white py-2 rounded-button text-sm hover:bg-primary/90 transition-colors whitespace-nowrap">开始分析</button>
<div class="mt-2 text-xs text-gray-500 debug-info" id="analysisDebugInfo" style="display: none;">
    <div>当前简历: <span id="debugCurrentResumeId">未选择</span></div>
    <div>分析状态: <span id="debugAnalysisStatus">未启动</span></div>
</div>
</div>
<div class="jd-analysis-result">
<div class="mb-4">
<div class="flex items-center justify-between mb-2">
<span class="text-sm font-medium text-gray-700">整体匹配度</span>
<span class="text-sm font-bold text-primary">85%</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-2">
<div class="bg-primary h-2 rounded-full" style="width: 85%"></div>
</div>
</div>
<div id="matchChart" class="h-48 mb-4"></div>
<div class="space-y-2">
<div class="bg-green-50 border border-green-200 rounded-lg p-3">
<h4 class="text-sm font-semibold text-green-800 mb-1">优势技能</h4>
<p class="text-xs text-green-700">Java, Spring Boot, 数据库设计</p>
</div>
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
<h4 class="text-sm font-semibold text-yellow-800 mb-1">需要加强</h4>
<p class="text-xs text-yellow-700">微服务架构, Docker, Kubernetes</p>
</div>
</div>
</div>
</div>
<!-- STAR 原则检测 -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">STAR 原则检测</h3>
<div class="space-y-4">
<div class="star-item border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-2">
<span class="text-sm font-medium text-gray-900">智能学习管理系统</span>
<div class="flex space-x-1">
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
</div>
</div>
<div class="grid grid-cols-4 gap-2 text-xs">
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">S</div>
<span class="text-green-600">完整</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">T</div>
<span class="text-green-600">清晰</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">A</div>
<span class="text-green-600">详细</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-1">R</div>
<span class="text-yellow-600">可优化</span>
</div>
</div>
<div class="mt-3 p-2 bg-blue-50 rounded text-xs text-blue-700">
<strong>建议：</strong>在结果部分添加更具体的量化数据，如"用户活跃度提升 40%"
</div>
</div>
<div class="star-item border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-2">
<span class="text-sm font-medium text-gray-900">电商数据分析平台</span>
<div class="flex space-x-1">
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
<span class="w-2 h-2 bg-green-400 rounded-full"></span>
</div>
</div>
<div class="grid grid-cols-4 gap-2 text-xs">
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">S</div>
<span class="text-green-600">完整</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">T</div>
<span class="text-green-600">清晰</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">A</div>
<span class="text-green-600">详细</span>
</div>
<div class="text-center">
<div class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-1">R</div>
<span class="text-green-600">优秀</span>
</div>
</div>
</div>
</div>
</div>
<!-- 简历健康度扫描 -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">简历健康度扫描</h3>
<div class="text-center mb-4">
<div id="healthChart" class="h-32"></div>
<p class="text-2xl font-bold text-green-600 mt-2">92分</p>
<p class="text-sm text-gray-500">整体健康度良好</p>
</div>
<div class="space-y-3">
<div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
<div class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center mr-3">
<i class="ri-check-line text-green-600"></i>
</div>
<span class="text-sm text-green-800">格式规范</span>
</div>
<span class="text-xs text-green-600">通过</span>
</div>
<div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
<div class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center mr-3">
<i class="ri-check-line text-green-600"></i>
</div>
<span class="text-sm text-green-800">联系方式</span>
</div>
<span class="text-xs text-green-600">完整</span>
</div>
<div class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
<div class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center mr-3">
<i class="ri-alert-line text-yellow-600"></i>
</div>
<span class="text-sm text-yellow-800">篇幅长度</span>
</div>
<span class="text-xs text-yellow-600">略长</span>
</div>
<div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
<div class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center mr-3">
<i class="ri-check-line text-green-600"></i>
</div>
<span class="text-sm text-green-800">语法检查</span>
</div>
<span class="text-xs text-green-600">无误</span>
</div>
</div>
<button onclick="startJDAnalysis()" class="w-full mt-4 bg-secondary text-white py-2 rounded-button text-sm hover:bg-secondary/90 transition-colors whitespace-nowrap">重新分析</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- 删除确认对话框 -->
<div id="deleteConfirmDialog" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-xl w-[400px] p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">确认删除</h3>
            <button id="closeDeleteDialog" class="text-gray-400 hover:text-gray-600">
                <i class="ri-close-line text-xl"></i>
            </button>
        </div>
        <div class="mb-6">
            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="ri-delete-bin-line text-red-500 text-xl"></i>
            </div>
            <p class="text-center text-gray-700 mb-2">确定要删除简历版本吗？</p>
            <p class="text-center text-sm text-gray-500" id="deleteResumeNameDisplay">此操作无法撤销</p>
        </div>
        <div class="flex space-x-3">
            <button id="cancelDeleteBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 transition-colors">
                取消
            </button>
            <button id="confirmDeleteBtn" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-button hover:bg-red-600 transition-colors">
                <span id="deleteButtonText">删除</span>
                <div id="deleteButtonLoading" class="hidden">
                    <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>
                </div>
            </button>
        </div>
    </div>
</div>

    <!-- 导入导航栏组件 -->
    <script src="./components/navbar.js"></script>

<!-- 简历数据管理脚本 -->
<script id="resumeDataManager">
document.addEventListener('DOMContentLoaded', function() {
    let currentResumeId = null;
    let resumesList = [];
    let currentAnalysisId = null;
    let analysisPollingInterval = null;


    // API调用函数
    async function callAPI(endpoint, method = 'GET', data = null) {
        try {
            const url = `/api/v1/resume${endpoint}`;
            console.log('API调用:', method, url, data);
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token') || ''}`
                }
            };

            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(url, options);
            console.log('API响应状态:', response.status, response.statusText);
            
            if (!response.ok) {
                let errorData = {};
                try {
                    errorData = await response.json();
                } catch (e) {
                    console.error('解析错误响应失败:', e);
                }
                const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}: ${response.statusText}`;
                console.error('API错误:', errorMessage, errorData);
                throw new Error(errorMessage);
            }

            const result = await response.json();
            console.log('API调用成功:', result);
            return result;
        } catch (error) {
            console.error('API调用失败:', error);
            throw error;
        }
    }

    // 获取简历列表
    async function loadResumesList() {
        const loadingEl = document.getElementById('resumeListLoading');
        const emptyEl = document.getElementById('resumeListEmpty');
        const errorEl = document.getElementById('resumeListError');
        const listContainer = document.getElementById('resumeVersionsList');

        try {
            // 显示加载状态
            loadingEl.classList.remove('hidden');
            emptyEl.classList.add('hidden');
            errorEl.classList.add('hidden');

            const response = await callAPI('/list');
            
            if (response.success && response.data) {
                resumesList = response.data;
                renderResumesList(resumesList);
                
                // 如果有简历，默认加载第一个
                if (resumesList.length > 0) {
                    await loadResumeDetail(resumesList[0].id);
                } else {
                    showResumePreviewEmpty();
                }
            } else {
                showResumeListEmpty();
            }
        } catch (error) {
            console.error('加载简历列表失败:', error);
            showResumeListError();
        } finally {
            loadingEl.classList.add('hidden');
        }
    }

    // 渲染简历列表
    function renderResumesList(resumes) {
        const listContainer = document.getElementById('resumeVersionsList');
        const loadingEl = document.getElementById('resumeListLoading');
        const emptyEl = document.getElementById('resumeListEmpty');
        const errorEl = document.getElementById('resumeListError');

        // 隐藏所有状态
        loadingEl.classList.add('hidden');
        emptyEl.classList.add('hidden');
        errorEl.classList.add('hidden');

        if (resumes.length === 0) {
            emptyEl.classList.remove('hidden');
            return;
        }

        // 清除现有内容（保留状态元素）
        const existingItems = listContainer.querySelectorAll('.version-item');
        existingItems.forEach(item => item.remove());

        // 渲染简历项目
        resumes.forEach((resume, index) => {
            const resumeItem = document.createElement('div');
            resumeItem.className = `version-item ${index === 0 ? 'bg-primary/5 border border-primary/20' : 'hover:bg-gray-50'} rounded-lg p-3 cursor-pointer`;
            resumeItem.dataset.resumeId = resume.id;

            const updatedAt = formatDate(resume.updated_at);
            const statusBadge = resume.status === 'draft' ? 
                '<span class="text-xs text-yellow-600 bg-yellow-50 px-2 py-1 rounded-full">草稿</span>' :
                (index === 0 ? '<span class="text-xs text-primary bg-primary/10 px-2 py-1 rounded-full">当前</span>' : '');

            resumeItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1" data-resume-content>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-900">${resume.version_name || '未命名简历'}</span>
                            ${statusBadge}
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                            ${resume.target_position ? `${resume.target_position} · ` : ''}最后修改：${updatedAt}
                        </p>
                    </div>
                    <div class="resume-actions hidden ml-2 flex items-center space-x-1">
                        <button class="edit-resume-btn p-1 text-gray-400 hover:text-blue-600 rounded transition-colors" 
                                data-resume-id="${resume.id}" 
                                title="编辑简历">
                            <i class="ri-edit-line text-xs"></i>
                        </button>
                        <button class="delete-resume-btn p-1 text-gray-400 hover:text-red-600 rounded transition-colors" 
                                data-resume-id="${resume.id}" 
                                data-resume-name="${resume.version_name || '未命名简历'}"
                                title="删除简历">
                            <i class="ri-delete-bin-line text-xs"></i>
                        </button>
                    </div>
                </div>
            `;

            // 添加悬停效果显示操作按钮
            resumeItem.addEventListener('mouseenter', function() {
                const actions = this.querySelector('.resume-actions');
                if (actions) actions.classList.remove('hidden');
            });

            resumeItem.addEventListener('mouseleave', function() {
                const actions = this.querySelector('.resume-actions');
                if (actions) actions.classList.add('hidden');
            });

            // 添加点击事件（只对内容区域有效）
            const contentArea = resumeItem.querySelector('[data-resume-content]');
            contentArea.addEventListener('click', async function(e) {
                e.stopPropagation();
                
                // 更新视觉状态
                document.querySelectorAll('.version-item').forEach(item => {
                    item.classList.remove('bg-primary/5', 'border-primary/20');
                    item.classList.add('hover:bg-gray-50');
                    const badge = item.querySelector('.text-primary.bg-primary\\/10');
                    if (badge) badge.remove();
                });

                resumeItem.classList.remove('hover:bg-gray-50');
                resumeItem.classList.add('bg-primary/5', 'border-primary/20');
                
                const titleDiv = contentArea.querySelector('.flex.items-center.justify-between');
                const existingBadge = titleDiv.querySelector('.text-primary.bg-primary\\/10');
                if (!existingBadge && resume.status !== 'draft') {
                    const currentBadge = document.createElement('span');
                    currentBadge.className = 'text-xs text-primary bg-primary/10 px-2 py-1 rounded-full';
                    currentBadge.textContent = '当前';
                    titleDiv.appendChild(currentBadge);
                }

                // 加载简历详情
                await loadResumeDetail(resume.id);
            });

            // 添加编辑按钮事件
            const editBtn = resumeItem.querySelector('.edit-resume-btn');
            editBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                editResume(resume.id);
            });

            // 添加删除按钮事件
            const deleteBtn = resumeItem.querySelector('.delete-resume-btn');
            deleteBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                showDeleteConfirmDialog(resume.id, resume.version_name || '未命名简历');
            });

            listContainer.appendChild(resumeItem);
        });
    }

    // 获取简历详情
    async function loadResumeDetail(resumeId) {
        const contentEl = document.getElementById('resumePreviewContent');
        const loadingEl = document.getElementById('resumePreviewLoading');
        const emptyEl = document.getElementById('resumePreviewEmpty');
        const errorEl = document.getElementById('resumePreviewError');

        try {
            console.log('设置当前简历ID:', resumeId);
            currentResumeId = resumeId;
            
            // 更新调试信息
            setTimeout(updateDebugInfo, 100);
            
            // 显示加载状态
            contentEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            errorEl.classList.add('hidden');
            loadingEl.classList.remove('hidden');

            const response = await callAPI(`/detail/${resumeId}`);
            
            if (response.success && response.data) {
                renderResumePreview(response.data);
                console.log('简历详情加载成功，currentResumeId:', currentResumeId);
                return response.data;
            } else {
                throw new Error('获取简历详情失败');
            }
        } catch (error) {
            console.error('加载简历详情失败:', error);
            showResumePreviewError();
            return null;
        } finally {
            loadingEl.classList.add('hidden');
        }
    }

    // 渲染简历预览
    function renderResumePreview(resumeData) {
        const contentEl = document.getElementById('resumePreviewContent');
        const loadingEl = document.getElementById('resumePreviewLoading');
        const emptyEl = document.getElementById('resumePreviewEmpty');
        const errorEl = document.getElementById('resumePreviewError');

        // 隐藏其他状态
        loadingEl.classList.add('hidden');
        emptyEl.classList.add('hidden');
        errorEl.classList.add('hidden');

        // 构建简历HTML
        const basicInfo = resumeData.basic_info || {};
        const education = resumeData.education || {};
        const projects = resumeData.projects || [];
        const skills = resumeData.skills || {};
        const internship = resumeData.internship || [];

        const resumeHTML = `
            <!-- 个人信息 -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">${basicInfo.name || '姓名'}</h1>
                <div class="flex justify-center items-center space-x-6 text-gray-600 flex-wrap">
                    ${basicInfo.phone ? `
                        <span class="flex items-center">
                            <div class="w-4 h-4 flex items-center justify-center mr-2">
                                <i class="ri-phone-line"></i>
                            </div>
                            ${basicInfo.phone}
                        </span>
                    ` : ''}
                    ${basicInfo.email ? `
                        <span class="flex items-center">
                            <div class="w-4 h-4 flex items-center justify-center mr-2">
                                <i class="ri-mail-line"></i>
                            </div>
                            ${basicInfo.email}
                        </span>
                    ` : ''}
                    ${basicInfo.github ? `
                        <span class="flex items-center">
                            <div class="w-4 h-4 flex items-center justify-center mr-2">
                                <i class="ri-github-line"></i>
                            </div>
                            ${basicInfo.github}
                        </span>
                    ` : ''}
                </div>
            </div>

            ${education.school ? `
            <!-- 教育背景 -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4 border-b-2 border-primary pb-2">教育背景</h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-gray-900">${education.school}</h3>
                                <p class="text-gray-600">${education.major || ''} ${education.degree ? '| ' + education.degree : ''}</p>
                            </div>
                            ${education.startTime && education.endTime ? `
                                <span class="text-gray-500">${education.startTime} - ${education.endTime}</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            </div>
            ` : ''}

            ${projects.length > 0 ? `
            <!-- 项目经历 -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4 border-b-2 border-primary pb-2">项目经历</h2>
                <div class="space-y-6">
                    ${projects.map(project => `
                        <div class="project-item">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-semibold text-gray-900">${project.name || '项目名称'}</h3>
                                ${project.time ? `<span class="text-gray-500">${project.time}</span>` : ''}
                            </div>
                            ${project.techStack ? `<p class="text-gray-600 mb-2">技术栈：${project.techStack}</p>` : ''}
                            ${project.description ? `
                                <div class="text-gray-700">
                                    ${project.description.split('\n').map(line => 
                                        line.trim() ? `<p class="mb-1">${line.startsWith('•') ? line : '• ' + line}</p>` : ''
                                    ).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}

            ${internship.length > 0 ? `
            <!-- 实习经历 -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4 border-b-2 border-primary pb-2">实习经历</h2>
                <div class="space-y-6">
                    ${internship.map(exp => `
                        <div class="internship-item">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="font-semibold text-gray-900">${exp.company || '公司名称'}</h3>
                                    <p class="text-gray-600">${exp.position || '职位名称'}</p>
                                </div>
                                ${exp.period ? `<span class="text-gray-500">${exp.period}</span>` : ''}
                            </div>
                            ${exp.description ? `
                                <div class="text-gray-700">
                                    ${exp.description.split('\n').map(line => 
                                        line.trim() ? `<p class="mb-1">${line.startsWith('•') ? line : '• ' + line}</p>` : ''
                                    ).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}

            ${Object.keys(skills).length > 0 ? `
            <!-- 技能清单 -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4 border-b-2 border-primary pb-2">技能清单</h2>
                <div class="grid grid-cols-2 gap-4">
                    ${skills.programmingLanguages ? `
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">编程语言</h4>
                            <p class="text-gray-700">${skills.programmingLanguages}</p>
                        </div>
                    ` : ''}
                    ${skills.frontend ? `
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">前端技术</h4>
                            <p class="text-gray-700">${skills.frontend}</p>
                        </div>
                    ` : ''}
                    ${skills.backend ? `
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">后端技术</h4>
                            <p class="text-gray-700">${skills.backend}</p>
                        </div>
                    ` : ''}
                    ${skills.database ? `
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">数据库</h4>
                            <p class="text-gray-700">${skills.database}</p>
                        </div>
                    ` : ''}
                </div>
            </div>
            ` : ''}
        `;

        contentEl.innerHTML = resumeHTML;
        contentEl.classList.remove('hidden');
    }

    // 显示状态函数
    function showResumeListEmpty() {
        document.getElementById('resumeListLoading').classList.add('hidden');
        document.getElementById('resumeListEmpty').classList.remove('hidden');
        document.getElementById('resumeListError').classList.add('hidden');
        showResumePreviewEmpty();
    }

    function showResumeListError() {
        document.getElementById('resumeListLoading').classList.add('hidden');
        document.getElementById('resumeListEmpty').classList.add('hidden');
        document.getElementById('resumeListError').classList.remove('hidden');
        showResumePreviewError();
    }

    function showResumePreviewEmpty() {
        document.getElementById('resumePreviewContent').classList.add('hidden');
        document.getElementById('resumePreviewLoading').classList.add('hidden');
        document.getElementById('resumePreviewEmpty').classList.remove('hidden');
        document.getElementById('resumePreviewError').classList.add('hidden');
    }

    function showResumePreviewError() {
        document.getElementById('resumePreviewContent').classList.add('hidden');
        document.getElementById('resumePreviewLoading').classList.add('hidden');
        document.getElementById('resumePreviewEmpty').classList.add('hidden');
        document.getElementById('resumePreviewError').classList.remove('hidden');
    }

    // 工具函数
    function formatDate(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        } catch (error) {
            return dateString;
        }
    }

    // 事件监听
    const retryLoadResumeBtn = document.getElementById('retryLoadResumes');
    if (retryLoadResumeBtn) {
        retryLoadResumeBtn.addEventListener('click', loadResumesList);
    }

    const retryLoadDetailBtn = document.getElementById('retryLoadResumeDetail');
    if (retryLoadDetailBtn) {
        retryLoadDetailBtn.addEventListener('click', function() {
            if (currentResumeId) {
                loadResumeDetail(currentResumeId);
            }
        });
    }

    // 编辑简历功能
    function editResume(resumeId) {
        if (!resumeId) {
            showErrorMessage('简历ID无效');
            return;
        }
        // 跳转到创建/编辑页面，传递简历ID参数
        window.location.href = `./Resume_create.html?id=${resumeId}&action=edit`;
    }

    // 显示删除确认对话框
    let currentDeleteResumeId = null;
    function showDeleteConfirmDialog(resumeId, resumeName) {
        currentDeleteResumeId = resumeId;
        const dialog = document.getElementById('deleteConfirmDialog');
        const nameDisplay = document.getElementById('deleteResumeNameDisplay');
        
        nameDisplay.textContent = `"${resumeName}"`;
        dialog.classList.remove('hidden');
    }

    // 隐藏删除确认对话框
    function hideDeleteConfirmDialog() {
        const dialog = document.getElementById('deleteConfirmDialog');
        const deleteBtn = document.getElementById('confirmDeleteBtn');
        const deleteText = document.getElementById('deleteButtonText');
        const deleteLoading = document.getElementById('deleteButtonLoading');
        
        dialog.classList.add('hidden');
        deleteBtn.disabled = false;
        deleteText.classList.remove('hidden');
        deleteLoading.classList.add('hidden');
        currentDeleteResumeId = null;
    }

    // 删除简历功能
    async function deleteResume(resumeId) {
        const deleteBtn = document.getElementById('confirmDeleteBtn');
        const deleteText = document.getElementById('deleteButtonText');
        const deleteLoading = document.getElementById('deleteButtonLoading');

        try {
            // 显示加载状态
            deleteBtn.disabled = true;
            deleteText.classList.add('hidden');
            deleteLoading.classList.remove('hidden');

            const response = await callAPI(`/delete/${resumeId}`, 'DELETE');
            
            if (response.success) {
                // 隐藏对话框
                hideDeleteConfirmDialog();
                
                // 显示成功消息
                showSuccessMessage('简历删除成功');
                
                // 如果删除的是当前预览的简历，清空预览区域
                if (currentResumeId === resumeId) {
                    currentResumeId = null;
                    showResumePreviewEmpty();
                }
                
                // 重新加载简历列表
                await loadResumesList();
            } else {
                throw new Error(response.message || '删除失败');
            }
        } catch (error) {
            console.error('删除简历失败:', error);
            showErrorMessage(error.message || '简历删除失败，请稍后重试');
            
            // 重置按钮状态
            deleteBtn.disabled = false;
            deleteText.classList.remove('hidden');
            deleteLoading.classList.add('hidden');
        }
    }

    // 消息提示函数
    function showSuccessMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'fixed top-6 right-6 bg-green-50 text-green-800 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2';
        messageDiv.innerHTML = `
            <div class="w-5 h-5 flex items-center justify-center">
                <i class="ri-check-line text-green-600"></i>
            </div>
            <span>${message}</span>
        `;
        document.body.appendChild(messageDiv);
        
        // 3秒后自动移除
        setTimeout(() => {
            if (messageDiv.parentNode) {
                messageDiv.remove();
            }
        }, 3000);
    }

    function showErrorMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'fixed top-6 right-6 bg-red-50 text-red-800 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2';
        messageDiv.innerHTML = `
            <div class="w-5 h-5 flex items-center justify-center">
                <i class="ri-close-line text-red-600"></i>
            </div>
            <span>${message}</span>
        `;
        document.body.appendChild(messageDiv);
        
        // 4秒后自动移除
        setTimeout(() => {
            if (messageDiv.parentNode) {
                messageDiv.remove();
            }
        }, 4000);
    }

    // 删除确认对话框事件处理
    document.getElementById('closeDeleteDialog').addEventListener('click', hideDeleteConfirmDialog);
    document.getElementById('cancelDeleteBtn').addEventListener('click', hideDeleteConfirmDialog);
    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        if (currentDeleteResumeId) {
            deleteResume(currentDeleteResumeId);
        }
    });

    // 点击对话框外部关闭
    document.getElementById('deleteConfirmDialog').addEventListener('click', function(e) {
        if (e.target === this) {
            hideDeleteConfirmDialog();
        }
    });

    // ==================== AI分析相关函数 ====================

    // 加载简历的AI分析结果
    async function loadResumeAnalysis(resumeId) {
        try {
            const response = await callAPI(`/analysis/result/${resumeId}`);
            
            if (response.success && response.data) {
                console.log('加载分析结果成功:', response.data);
                renderAnalysisResults(response.data);
                return response.data;
            } else {
                console.log('暂无分析结果，显示默认数据');
                showAnalysisLoading();
                return null;
            }
        } catch (error) {
            console.error('加载分析结果失败:', error);
            showAnalysisError();
            return null;
        }
    }

    // 触发新的AI分析
    async function triggerResumeAnalysis(resumeId, jdContent = '') {
        try {
            console.log('准备触发AI分析:', { resumeId, jdContent: jdContent.substring(0, 100) + '...' });
            
            const requestData = {
                jd_content: jdContent
            };

            console.log('发送API请求:', `/analyze/${resumeId}`, requestData);
            const response = await callAPI(`/analyze/${resumeId}`, 'POST', requestData);
            console.log('API响应:', response);
            
            if (response.success) {
                currentAnalysisId = response.analysis_id;
                console.log('分析任务已启动:', currentAnalysisId);
                
                // 更新调试信息
                updateDebugInfo();
                
                // 开始轮询分析状态
                startAnalysisPolling();
                
                // 显示分析进行中的UI
                showAnalysisInProgress();
                
                // 显示成功消息
                showSuccessMessage('AI分析已开始，请稍候...');
                
                return response.analysis_id;
            } else {
                throw new Error(response.message || '启动分析失败');
            }
        } catch (error) {
            console.error('触发分析失败:', error);
            showErrorMessage('启动AI分析失败: ' + (error.message || error.toString()));
            return null;
        }
    }

    // 轮询分析状态
    function startAnalysisPolling() {
        if (analysisPollingInterval) {
            clearInterval(analysisPollingInterval);
        }

        analysisPollingInterval = setInterval(async () => {
            if (!currentAnalysisId) {
                clearInterval(analysisPollingInterval);
                return;
            }

            try {
                const response = await callAPI(`/analysis/status/${currentAnalysisId}`);
                
                if (response.success && response.data) {
                    const analysisData = response.data;
                    updateAnalysisProgress(analysisData);

                    if (analysisData.status === 'completed') {
                        clearInterval(analysisPollingInterval);
                        renderAnalysisResults(analysisData);
                        currentAnalysisId = null;
                        analysisPollingInterval = null;
                        console.log('AI分析完成');
                        
                        // 更新调试信息
                        updateDebugInfo();
                        
                        // 显示完成消息
                        showSuccessMessage('AI分析已完成！');
                    } else if (analysisData.status === 'failed') {
                        clearInterval(analysisPollingInterval);
                        showAnalysisError(analysisData.error || '分析失败');
                        currentAnalysisId = null;
                        analysisPollingInterval = null;
                        
                        // 更新调试信息
                        updateDebugInfo();
                    }
                }
            } catch (error) {
                console.error('获取分析状态失败:', error);
            }
        }, 2000); // 每2秒检查一次
    }

    // 更新分析进度
    function updateAnalysisProgress(analysisData) {
        const progress = analysisData.progress || 0;
        const status = analysisData.status;
        
        // 更新JD匹配分析进度
        const jdProgress = document.querySelector('#jdAnalysisProgress');
        const starProgress = document.querySelector('#starAnalysisProgress');
        const healthProgress = document.querySelector('#healthAnalysisProgress');
        
        if (jdProgress) {
            if (progress >= 33) {
                jdProgress.style.width = '100%';
                jdProgress.parentElement.classList.add('completed');
            } else {
                jdProgress.style.width = Math.min(progress * 3, 100) + '%';
            }
        }
        
        if (starProgress) {
            if (progress >= 66) {
                starProgress.style.width = '100%';
                starProgress.parentElement.classList.add('completed');
            } else if (progress >= 33) {
                starProgress.style.width = ((progress - 33) * 3) + '%';
            }
        }
        
        if (healthProgress) {
            if (progress >= 100) {
                healthProgress.style.width = '100%';
                healthProgress.parentElement.classList.add('completed');
            } else if (progress >= 66) {
                healthProgress.style.width = ((progress - 66) * 3) + '%';
            }
        }

        // 更新状态文本
        const statusText = document.querySelector('#analysisStatusText');
        if (statusText) {
            const statusMessages = {
                'processing': '准备中...',
                'analyzing_jd': 'JD智能匹配分析中...',
                'analyzing_star': 'STAR原则检测中...',
                'analyzing_health': '简历健康度扫描中...'
            };
            statusText.textContent = statusMessages[status] || `分析中... ${progress}%`;
        }
    }

    // 显示分析进行中的UI
    function showAnalysisInProgress() {
        // JD匹配分析区域
        const jdAnalysis = document.querySelector('.jd-analysis-result');
        if (jdAnalysis) {
            jdAnalysis.innerHTML = `
                <div class="analysis-loading text-center py-8">
                    <div class="flex flex-col items-center space-y-4">
                        <div class="w-12 h-12 relative">
                            <div class="w-full h-full border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div>
                        </div>
                        <div class="space-y-2">
                            <p class="text-sm font-medium text-gray-900" id="analysisStatusText">AI分析进行中...</p>
                            <div class="w-64 bg-gray-200 rounded-full h-2">
                                <div class="bg-primary h-2 rounded-full transition-all duration-500" style="width: 0%" id="overallProgress"></div>
                            </div>
                        </div>
                        <div class="space-y-3 w-full max-w-sm">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 border-2 border-blue-200 border-t-blue-500 rounded-full animate-spin analysis-step"></div>
                                <span class="text-sm text-gray-600">JD智能匹配分析</span>
                                <div class="flex-1 bg-gray-200 rounded-full h-1">
                                    <div class="bg-blue-500 h-1 rounded-full transition-all duration-500" style="width: 0%" id="jdAnalysisProgress"></div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 border-2 border-gray-300 rounded-full analysis-step"></div>
                                <span class="text-sm text-gray-600">STAR原则检测</span>
                                <div class="flex-1 bg-gray-200 rounded-full h-1">
                                    <div class="bg-yellow-500 h-1 rounded-full transition-all duration-500" style="width: 0%" id="starAnalysisProgress"></div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 border-2 border-gray-300 rounded-full analysis-step"></div>
                                <span class="text-sm text-gray-600">简历健康度扫描</span>
                                <div class="flex-1 bg-gray-200 rounded-full h-1">
                                    <div class="bg-green-500 h-1 rounded-full transition-all duration-500" style="width: 0%" id="healthAnalysisProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // STAR原则检测区域
        const starDetection = document.querySelector('#starDetectionContent');
        if (starDetection) {
            starDetection.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-8 h-8 border-2 border-yellow-300 border-t-yellow-500 rounded-full animate-spin mx-auto mb-4"></div>
                    <p class="text-sm text-gray-600">STAR原则检测中...</p>
                </div>
            `;
        }

        // 简历健康度区域
        const healthScan = document.querySelector('#healthScanContent');
        if (healthScan) {
            healthScan.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-8 h-8 border-2 border-green-300 border-t-green-500 rounded-full animate-spin mx-auto mb-4"></div>
                    <p class="text-sm text-gray-600">健康度扫描中...</p>
                </div>
            `;
        }
    }

    // 渲染分析结果
    function renderAnalysisResults(analysisData) {
        try {
            console.log('渲染分析结果:', analysisData);
            
            // 渲染JD匹配分析
            if (analysisData.jd_matching) {
                renderJDMatching(analysisData.jd_matching);
            }
            
            // 渲染STAR原则检测
            if (analysisData.star_principle) {
                renderSTARPrinciple(analysisData.star_principle);
            }
            
            // 渲染简历健康度
            if (analysisData.health_scan) {
                renderHealthScan(analysisData.health_scan);
            }

        } catch (error) {
            console.error('渲染分析结果失败:', error);
            showErrorMessage('分析结果渲染失败');
        }
    }

    // 渲染JD匹配分析
    function renderJDMatching(jdData) {
        const matchChart = document.getElementById('matchChart');
        const jdResult = document.querySelector('.jd-analysis-result');
        
        if (!jdResult) return;

        // 更新匹配度百分比
        const matchPercentage = document.querySelector('.jd-analysis-result').parentElement.querySelector('.text-primary');
        if (matchPercentage) {
            matchPercentage.textContent = `${jdData.overall_match || 82}%`;
        }

        // 更新进度条
        const progressBar = document.querySelector('.jd-analysis-result').parentElement.querySelector('.bg-primary');
        if (progressBar) {
            progressBar.style.width = `${jdData.overall_match || 82}%`;
        }

        // 重新渲染雷达图
        if (matchChart && jdData.match_details) {
            const chart = echarts.init(matchChart);
            const option = {
                animation: false,
                radar: {
                    indicator: Object.keys(jdData.match_details).map(key => ({
                        name: key,
                        max: 100
                    })),
                    radius: 60,
                    axisLine: { lineStyle: { color: '#e5e7eb' } },
                    splitLine: { lineStyle: { color: '#e5e7eb' } },
                    axisLabel: { fontSize: 10, color: '#6b7280' }
                },
                series: [{
                    type: 'radar',
                    data: [{
                        value: Object.values(jdData.match_details),
                        name: '匹配度',
                        areaStyle: { color: 'rgba(87, 181, 231, 0.1)' },
                        lineStyle: { color: 'rgba(87, 181, 231, 1)' },
                        itemStyle: { color: 'rgba(87, 181, 231, 1)' }
                    }]
                }]
            };
            chart.setOption(option);
        }

        // 更新优势和需要加强的内容
        const strengthsElement = jdResult.querySelector('.bg-green-50 p');
        if (strengthsElement && jdData.strengths) {
            strengthsElement.textContent = jdData.strengths.join(', ');
        }

        const gapsElement = jdResult.querySelector('.bg-yellow-50 p');
        if (gapsElement && jdData.gaps) {
            gapsElement.textContent = jdData.gaps.join(', ');
        }
    }

    // 渲染STAR原则检测
    function renderSTARPrinciple(starData) {
        const starContainer = document.querySelector('#starDetectionContent') || 
                             document.querySelector('.bg-white.rounded-xl.shadow-sm.border.border-gray-200.p-6:nth-child(2) .space-y-4');
        
        if (!starContainer) return;

        const starItemsHTML = starData.star_items ? starData.star_items.map(item => `
            <div class="star-item border border-gray-200 rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-900">${item.name || '项目'}</span>
                    <div class="flex space-x-1">
                        <span class="w-2 h-2 ${item.situation_score >= 70 ? 'bg-green-400' : 'bg-yellow-400'} rounded-full"></span>
                        <span class="w-2 h-2 ${item.task_score >= 70 ? 'bg-green-400' : 'bg-yellow-400'} rounded-full"></span>
                        <span class="w-2 h-2 ${item.action_score >= 70 ? 'bg-green-400' : 'bg-yellow-400'} rounded-full"></span>
                        <span class="w-2 h-2 ${item.result_score >= 70 ? 'bg-green-400' : 'bg-yellow-400'} rounded-full"></span>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-2 text-xs">
                    <div class="text-center">
                        <div class="w-6 h-6 ${item.situation_score >= 70 ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} rounded-full flex items-center justify-center mx-auto mb-1">S</div>
                        <span class="${item.situation_score >= 70 ? 'text-green-600' : 'text-yellow-600'}">${item.situation_score >= 70 ? '完整' : '可优化'}</span>
                    </div>
                    <div class="text-center">
                        <div class="w-6 h-6 ${item.task_score >= 70 ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} rounded-full flex items-center justify-center mx-auto mb-1">T</div>
                        <span class="${item.task_score >= 70 ? 'text-green-600' : 'text-yellow-600'}">${item.task_score >= 70 ? '清晰' : '可优化'}</span>
                    </div>
                    <div class="text-center">
                        <div class="w-6 h-6 ${item.action_score >= 70 ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} rounded-full flex items-center justify-center mx-auto mb-1">A</div>
                        <span class="${item.action_score >= 70 ? 'text-green-600' : 'text-yellow-600'}">${item.action_score >= 70 ? '详细' : '可优化'}</span>
                    </div>
                    <div class="text-center">
                        <div class="w-6 h-6 ${item.result_score >= 70 ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} rounded-full flex items-center justify-center mx-auto mb-1">R</div>
                        <span class="${item.result_score >= 70 ? 'text-green-600' : 'text-yellow-600'}">${item.result_score >= 70 ? '优秀' : '可优化'}</span>
                    </div>
                </div>
                ${item.suggestions && item.suggestions.length > 0 ? `
                    <div class="mt-3 p-2 bg-blue-50 rounded text-xs text-blue-700">
                        <strong>建议：</strong>${item.suggestions.join('；')}
                    </div>
                ` : ''}
            </div>
        `).join('') : '';

        starContainer.innerHTML = `
            <div class="space-y-4" id="starDetectionContent">
                ${starItemsHTML}
                ${starData.improvement_suggestions ? `
                    <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                        <h4 class="text-sm font-semibold text-amber-800 mb-2">整体优化建议</h4>
                        <ul class="text-xs text-amber-700 space-y-1">
                            ${starData.improvement_suggestions.map(suggestion => `<li>• ${suggestion}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            </div>
        `;
    }

    // 渲染简历健康度扫描
    function renderHealthScan(healthData) {
        // 更新健康度分数
        const healthScore = document.querySelector('.text-2xl.font-bold.text-green-600');
        if (healthScore) {
            healthScore.textContent = `${healthData.overall_health || 88}分`;
        }

        // 更新健康度描述
        const healthDesc = document.querySelector('.text-sm.text-gray-500');
        if (healthDesc) {
            const score = healthData.overall_health || 88;
            if (score >= 90) {
                healthDesc.textContent = '整体健康度优秀';
                healthDesc.className = 'text-sm text-green-600';
            } else if (score >= 80) {
                healthDesc.textContent = '整体健康度良好';
                healthDesc.className = 'text-sm text-blue-600';
            } else {
                healthDesc.textContent = '有优化空间';
                healthDesc.className = 'text-sm text-yellow-600';
            }
        }

        // 更新健康检查项目
        const healthChecks = document.querySelector('#healthScanContent') ||
                            document.querySelector('.space-y-3');
        
        if (healthChecks && healthData.health_checks) {
            const healthCheckHTML = healthData.health_checks.map(check => {
                const statusColor = check.status === '通过' ? 'green' :
                                  check.status === '完整' ? 'green' :
                                  check.status === '良好' ? 'blue' :
                                  check.status === '优秀' ? 'green' : 'yellow';
                
                return `
                    <div class="flex items-center justify-between p-3 bg-${statusColor}-50 border border-${statusColor}-200 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-${check.status === '通过' || check.status === '完整' || check.status === '优秀' ? 'check' : 'alert'}-line text-${statusColor}-600"></i>
                            </div>
                            <span class="text-sm text-${statusColor}-800">${check.category}</span>
                        </div>
                        <span class="text-xs text-${statusColor}-600">${check.status}</span>
                    </div>
                `;
            }).join('');

            healthChecks.innerHTML = healthCheckHTML;
        }

        // 重新渲染健康度仪表盘
        const healthChart = document.getElementById('healthChart');
        if (healthChart && healthData.overall_health) {
            const chart = echarts.init(healthChart);
            const score = healthData.overall_health;
            const option = {
                animation: false,
                series: [{
                    type: 'gauge',
                    startAngle: 180,
                    endAngle: 0,
                    min: 0,
                    max: 100,
                    radius: '80%',
                    center: ['50%', '70%'],
                    axisLine: {
                        lineStyle: {
                            width: 8,
                            color: [
                                [0.6, '#ff6b6b'], 
                                [0.8, '#ffd93d'], 
                                [1, score >= 90 ? '#4ade80' : score >= 80 ? '#6bcf7f' : '#ffd93d']
                            ]
                        }
                    },
                    pointer: {
                        itemStyle: { color: score >= 90 ? '#4ade80' : score >= 80 ? '#6bcf7f' : '#ffd93d' }
                    },
                    axisTick: { show: false },
                    splitLine: { show: false },
                    axisLabel: { show: false },
                    detail: { show: false },
                    data: [{ value: score }]
                }]
            };
            chart.setOption(option);
        }
    }

    // 显示分析加载状态
    function showAnalysisLoading() {
        console.log('显示分析加载状态');
        // 可以在这里显示一些默认的加载状态
    }

    // 显示分析错误
    function showAnalysisError(error = '分析加载失败') {
        const jdResult = document.querySelector('.jd-analysis-result');
        if (jdResult) {
            jdResult.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ri-error-warning-line text-red-500 text-xl"></i>
                    </div>
                    <p class="text-red-600 mb-4">${error}</p>
                    <button onclick="retryAnalysis()" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 transition-colors">
                        重新分析
                    </button>
                </div>
            `;
        }
    }

    // 重新分析
    window.retryAnalysis = function() {
        if (currentResumeId) {
            triggerResumeAnalysis(currentResumeId);
        }
    };

    // 手动触发JD分析
    window.startJDAnalysis = function() {
        console.log('startJDAnalysis 被调用');
        console.log('当前简历ID:', currentResumeId);
        
        const jdTextarea = document.querySelector('textarea');
        const jdContent = jdTextarea ? jdTextarea.value.trim() : '';
        console.log('JD内容:', jdContent);
        
        if (currentResumeId) {
            console.log('开始触发分析...');
            triggerResumeAnalysis(currentResumeId, jdContent);
        } else {
            console.error('没有选中的简历');
            showErrorMessage('请先选择一个简历版本');
        }
    };

    // 修改原有的加载简历详情函数，在加载完成后获取分析结果
    const originalLoadResumeDetail = loadResumeDetail;
    
    loadResumeDetail = async function(resumeId) {
        console.log('调用增强版 loadResumeDetail:', resumeId);
        const result = await originalLoadResumeDetail(resumeId);
        
        // 加载对应的AI分析结果
        if (result) {
            console.log('简历加载成功，开始加载分析结果...');
            setTimeout(() => {
                loadResumeAnalysis(resumeId);
            }, 500); // 延迟500ms加载分析结果，让简历内容先展示
        } else {
            console.log('简历加载失败，跳过分析结果加载');
        }
        
        return result;
    };

    // 更新调试信息显示
    function updateDebugInfo() {
        const debugInfo = document.getElementById('analysisDebugInfo');
        const debugCurrentResumeId = document.getElementById('debugCurrentResumeId');
        const debugAnalysisStatus = document.getElementById('debugAnalysisStatus');
        
        if (debugInfo && debugCurrentResumeId && debugAnalysisStatus) {
            // 显示调试信息
            debugInfo.style.display = 'block';
            
            // 更新简历ID显示
            debugCurrentResumeId.textContent = currentResumeId || '未选择';
            
            // 更新分析状态
            if (currentAnalysisId && analysisPollingInterval) {
                debugAnalysisStatus.textContent = '分析中...';
                debugAnalysisStatus.className = 'text-yellow-600';
            } else if (currentResumeId) {
                debugAnalysisStatus.textContent = '准备就绪';
                debugAnalysisStatus.className = 'text-green-600';
            } else {
                debugAnalysisStatus.textContent = '未启动';
                debugAnalysisStatus.className = 'text-gray-500';
            }
        }
    }

    // 调试功能 - 在控制台检查状态
    window.debugResumeAnalysis = function() {
        console.log('=== 简历分析调试信息 ===');
        console.log('currentResumeId:', currentResumeId);
        console.log('currentAnalysisId:', currentAnalysisId);
        console.log('分析轮询状态:', analysisPollingInterval ? '进行中' : '未启动');
        console.log('简历列表:', resumesList);
        
        const jdTextarea = document.querySelector('textarea');
        console.log('JD输入框:', jdTextarea);
        console.log('JD内容:', jdTextarea ? jdTextarea.value : '未找到');
        
        // 检查必要的函数是否存在
        console.log('showErrorMessage 函数:', typeof showErrorMessage);
        console.log('showSuccessMessage 函数:', typeof showSuccessMessage);
        console.log('triggerResumeAnalysis 函数:', typeof triggerResumeAnalysis);
        
        console.log('========================');
        
        // 同时更新页面上的调试信息
        updateDebugInfo();
    };
    
    // 确保消息函数存在
    if (typeof showSuccessMessage === 'undefined') {
        window.showSuccessMessage = function(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'fixed top-6 right-6 bg-green-50 text-green-800 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2';
            messageDiv.innerHTML = `
                <div class="w-5 h-5 flex items-center justify-center">
                    <i class="ri-check-line text-green-600"></i>
                </div>
                <span>${message}</span>
            `;
            document.body.appendChild(messageDiv);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        };
    }
    
    if (typeof showErrorMessage === 'undefined') {
        window.showErrorMessage = function(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'fixed top-6 right-6 bg-red-50 text-red-800 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2';
            messageDiv.innerHTML = `
                <div class="w-5 h-5 flex items-center justify-center">
                    <i class="ri-close-line text-red-600"></i>
                </div>
                <span>${message}</span>
            `;
            document.body.appendChild(messageDiv);
            
            // 4秒后自动移除
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 4000);
        };
    }

    // 初始化
    loadResumesList();
    
    console.log('简历管理页面初始化完成');
    console.log('使用 debugResumeAnalysis() 查看调试信息');
});
</script>

<script id="navigation">
document.addEventListener('DOMContentLoaded', function() {
const navItems = document.querySelectorAll('.nav-item');
const mainContent = document.querySelector('.flex-1.flex.flex-col');
const careerContent = `
<div class="bg-white border-b border-gray-200 p-6">
<div class="flex items-center justify-between">
<div>
<h1 class="text-2xl font-bold text-gray-900">职业发展规划</h1>
<p class="text-gray-500 mt-1">基于您的背景和目标，为您规划最优职业发展路径</p>
</div>
</div>
</div>
<div class="flex-1 p-6 bg-gray-50">
<div class="grid grid-cols-2 gap-6">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">职业路径规划</h3>
<div id="careerPathChart" class="h-80"></div>
</div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">技能发展建议</h3>
<div class="space-y-4">
<div class="p-4 bg-blue-50 rounded-lg">
<h4 class="font-medium text-blue-900 mb-2">核心技能提升</h4>
<div class="space-y-3">
<div>
<div class="flex justify-between text-sm mb-1">
<span class="text-blue-800">系统架构设计</span>
<span class="text-blue-600">优先级高</span>
</div>
<div class="w-full bg-blue-200 rounded-full h-2">
<div class="bg-blue-600 h-2 rounded-full" style="width: 35%"></div>
</div>
</div>
<div>
<div class="flex justify-between text-sm mb-1">
<span class="text-blue-800">微服务开发</span>
<span class="text-blue-600">优先级高</span>
</div>
<div class="w-full bg-blue-200 rounded-full h-2">
<div class="bg-blue-600 h-2 rounded-full" style="width: 45%"></div>
</div>
</div>
</div>
</div>
<div class="p-4 bg-green-50 rounded-lg">
<h4 class="font-medium text-green-900 mb-2">软技能培养</h4>
<div class="space-y-3">
<div>
<div class="flex justify-between text-sm mb-1">
<span class="text-green-800">项目管理</span>
<span class="text-green-600">持续提升</span>
</div>
<div class="w-full bg-green-200 rounded-full h-2">
<div class="bg-green-600 h-2 rounded-full" style="width: 60%"></div>
</div>
</div>
<div>
<div class="flex justify-between text-sm mb-1">
<span class="text-green-800">团队协作</span>
<span class="text-green-600">持续提升</span>
</div>
<div class="w-full bg-green-200 rounded-full h-2">
<div class="bg-green-600 h-2 rounded-full" style="width: 75%"></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">行业趋势分析</h3>
<div id="industryTrendChart" class="h-80"></div>
</div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
<h3 class="text-lg font-semibold text-gray-900 mb-4">目标岗位推荐</h3>
<div class="space-y-4">
<div class="p-4 border border-gray-200 rounded-lg hover:border-primary transition-colors cursor-pointer">
<div class="flex items-center justify-between mb-2">
<h4 class="font-medium text-gray-900">高级后端工程师</h4>
<span class="text-primary text-sm">匹配度 92%</span>
</div>
<p class="text-gray-600 text-sm mb-3">薪资范围：30k-45k</p>
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">Java</span>
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">Spring Cloud</span>
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">微服务</span>
</div>
</div>
<div class="p-4 border border-gray-200 rounded-lg hover:border-primary transition-colors cursor-pointer">
<div class="flex items-center justify-between mb-2">
<h4 class="font-medium text-gray-900">技术架构师</h4>
<span class="text-primary text-sm">匹配度 85%</span>
</div>
<p class="text-gray-600 text-sm mb-3">薪资范围：45k-60k</p>
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">系统架构</span>
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">技术管理</span>
<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">分布式</span>
</div>
</div>
</div>
</div>
</div>
</div>`;
const originalContent = mainContent.innerHTML;
navItems.forEach(item => {
item.addEventListener('click', function(e) {
// 如果是链接，让它正常跳转
if (this.tagName === 'A') {
return true;
}
if (this.classList.contains('active')) {
this.classList.add('animate-pulse');
setTimeout(() => {
this.classList.remove('animate-pulse');
}, 1000);
return;
}
navItems.forEach(nav => {
nav.classList.remove('active', 'bg-primary/10', 'text-primary');
nav.classList.add('text-gray-600', 'hover:bg-gray-50');
});
this.classList.remove('text-gray-600', 'hover:bg-gray-50');
this.classList.add('active', 'bg-primary/10', 'text-primary');
if (this.querySelector('span').textContent === '智能分析与诊断') {
mainContent.innerHTML = originalContent;
const chartsScript = document.getElementById('charts');
if (chartsScript) {
eval(chartsScript.textContent);
}
}
});
});
function initCareerCharts() {
const careerPathChart = echarts.init(document.getElementById('careerPathChart'));
const industryTrendChart = echarts.init(document.getElementById('industryTrendChart'));
const careerPathOption = {
animation: false,
tooltip: {
trigger: 'item'
},
series: [{
type: 'graph',
layout: 'force',
roam: true,
nodes: [
{name: '当前\n后端开发', value: 20, category: 0, symbolSize: 60},
{name: '高级后端\n工程师', value: 15, category: 1, symbolSize: 50},
{name: '技术\n架构师', value: 10, category: 1, symbolSize: 50},
{name: '技术\n总监', value: 5, category: 2, symbolSize: 40}
],
categories: [
{name: '当前'},
{name: '2-3年'},
{name: '3-5年'}
],
edges: [
{source: '当前\n后端开发', target: '高级后端\n工程师'},
{source: '高级后端\n工程师', target: '技术\n架构师'},
{source: '技术\n架构师', target: '技术\n总监'}
],
lineStyle: {
color: 'rgba(87, 181, 231, 1)',
width: 2
},
itemStyle: {
color: 'rgba(87, 181, 231, 1)'
},
label: {
show: true,
position: 'inside',
color: '#fff',
fontSize: 12
},
force: {
repulsion: 1000,
edgeLength: 120
}
}]
};
const industryTrendOption = {
animation: false,
tooltip: {
trigger: 'axis'
},
xAxis: {
type: 'category',
data: ['2024', '2025', '2026', '2027', '2028'],
axisLine: {
lineStyle: {
color: '#e5e7eb'
}
}
},
yAxis: {
type: 'value',
name: '需求量',
axisLine: {
lineStyle: {
color: '#e5e7eb'
}
},
splitLine: {
lineStyle: {
color: '#e5e7eb'
}
}
},
series: [{
name: '后端开发',
type: 'line',
smooth: true,
data: [100, 120, 140, 160, 180],
lineStyle: {
color: 'rgba(87, 181, 231, 1)'
},
itemStyle: {
color: 'rgba(87, 181, 231, 1)'
},
areaStyle: {
color: 'rgba(87, 181, 231, 0.1)'
}
}]
};
careerPathChart.setOption(careerPathOption);
industryTrendChart.setOption(industryTrendOption);
window.addEventListener('resize', function() {
careerPathChart.resize();
industryTrendChart.resize();
});
}
});
</script>
<script id="versionManagement">
document.addEventListener('DOMContentLoaded', function() {
const versionItems = document.querySelectorAll('.version-item');
versionItems.forEach(item => {
item.addEventListener('click', function() {
versionItems.forEach(version => {
version.classList.remove('bg-primary/5', 'border-primary/20');
version.classList.add('hover:bg-gray-50');
const currentBadge = version.querySelector('.text-primary.bg-primary\\/10');
if (currentBadge) {
currentBadge.remove();
}
});
this.classList.remove('hover:bg-gray-50');
this.classList.add('bg-primary/5', 'border-primary/20');
const titleDiv = this.querySelector('.flex.items-center.justify-between');
if (!titleDiv.querySelector('.text-primary.bg-primary\\/10')) {
const currentBadge = document.createElement('span');
currentBadge.className = 'text-xs text-primary bg-primary/10 px-2 py-1 rounded-full';
currentBadge.textContent = '当前';
titleDiv.appendChild(currentBadge);
}
});
});
});
</script>
<script id="charts">
document.addEventListener('DOMContentLoaded', function() {
const matchChart = echarts.init(document.getElementById('matchChart'));
const matchOption = {
animation: false,
radar: {
indicator: [
{ name: '技术能力', max: 100 },
{ name: '项目经验', max: 100 },
{ name: '教育背景', max: 100 },
{ name: '工作经验', max: 100 },
{ name: '软技能', max: 100 }
],
radius: 60,
axisLine: { lineStyle: { color: '#e5e7eb' } },
splitLine: { lineStyle: { color: '#e5e7eb' } },
axisLabel: { fontSize: 10, color: '#6b7280' }
},
series: [{
type: 'radar',
data: [{
value: [85, 78, 92, 45, 88],
name: '匹配度',
areaStyle: { color: 'rgba(87, 181, 231, 0.1)' },
lineStyle: { color: 'rgba(87, 181, 231, 1)' },
itemStyle: { color: 'rgba(87, 181, 231, 1)' }
}]
}],
grid: { top: 0, bottom: 0, left: 0, right: 0 }
};
matchChart.setOption(matchOption);
const healthChart = echarts.init(document.getElementById('healthChart'));
const healthOption = {
animation: false,
series: [{
type: 'gauge',
startAngle: 180,
endAngle: 0,
min: 0,
max: 100,
radius: '80%',
center: ['50%', '70%'],
axisLine: {
lineStyle: {
width: 8,
color: [[0.6, '#ff6b6b'], [0.8, '#ffd93d'], [1, '#6bcf7f']]
}
},
pointer: {
itemStyle: { color: '#6bcf7f' }
},
axisTick: { show: false },
splitLine: { show: false },
axisLabel: { show: false },
detail: { show: false },
data: [{ value: 92 }]
}],
grid: { top: 0, bottom: 0, left: 0, right: 0 }
};
healthChart.setOption(healthOption);
window.addEventListener('resize', function() {
matchChart.resize();
healthChart.resize();
});
});
</script>
<script id="interactions">
document.addEventListener('DOMContentLoaded', function() {
const uploadBtn = document.getElementById('uploadResumeBtn');
const uploadDialog = document.getElementById('uploadDialog');
const closeBtn = document.getElementById('closeUploadDialog');
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const uploadProgress = document.getElementById('uploadProgress');
const progressBar = document.getElementById('progressBar');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const uploadStatus = document.getElementById('uploadStatus');
const progressPercent = document.getElementById('progressPercent');
uploadBtn.addEventListener('click', () => {
uploadDialog.classList.remove('hidden');
});
closeBtn.addEventListener('click', () => {
uploadDialog.classList.add('hidden');
resetUploadState();
});
dropZone.addEventListener('click', () => {
fileInput.click();
});
dropZone.addEventListener('dragover', (e) => {
e.preventDefault();
dropZone.classList.add('border-primary');
});
dropZone.addEventListener('dragleave', () => {
dropZone.classList.remove('border-primary');
});
dropZone.addEventListener('drop', (e) => {
e.preventDefault();
dropZone.classList.remove('border-primary');
const file = e.dataTransfer.files[0];
handleFileUpload(file);
});
fileInput.addEventListener('change', (e) => {
const file = e.target.files[0];
handleFileUpload(file);
});
function handleFileUpload(file) {
if (!file) return;
const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
if (!allowedTypes.includes(file.type)) {
showUploadError('不支持的文件格式');
return;
}
fileName.textContent = file.name;
fileSize.textContent = formatFileSize(file.size);
dropZone.classList.add('hidden');
uploadProgress.classList.remove('hidden');
simulateUpload();
}
function simulateUpload() {
let progress = 0;
const interval = setInterval(() => {
progress += 5;
progressBar.style.width = `${progress}%`;
progressPercent.textContent = `${progress}%`;
if (progress >= 100) {
clearInterval(interval);
uploadStatus.textContent = '解析中...';
setTimeout(() => {
uploadDialog.classList.add('hidden');
resetUploadState();
refreshPreview();
}, 1000);
}
}, 100);
}
function showUploadError(message) {
uploadStatus.textContent = message;
uploadStatus.classList.add('text-red-500');
setTimeout(resetUploadState, 3000);
}
function resetUploadState() {
dropZone.classList.remove('hidden');
uploadProgress.classList.add('hidden');
progressBar.style.width = '0%';
uploadStatus.textContent = '正在上传...';
uploadStatus.classList.remove('text-red-500');
fileInput.value = '';
}
function refreshPreview() {
// Here you would typically update the resume preview and analysis results
// For now, we'll just show a success message
const messageDiv = document.createElement('div');
messageDiv.className = 'fixed top-4 right-4 bg-green-50 text-green-800 px-4 py-2 rounded-lg shadow-lg z-50';
messageDiv.textContent = '简历导入成功';
document.body.appendChild(messageDiv);
setTimeout(() => messageDiv.remove(), 3000);
}
function formatFileSize(bytes) {
if (bytes === 0) return '0 B';
const k = 1024;
const sizes = ['B', 'KB', 'MB', 'GB'];
const i = Math.floor(Math.log(bytes) / Math.log(k));
return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}
const jdTextarea = document.querySelector('textarea');
const analyzeBtn = document.querySelector('.jd-analysis-result').previousElementSibling.querySelector('button');
const analysisResult = document.querySelector('.jd-analysis-result');
analyzeBtn.addEventListener('click', function() {
if (jdTextarea.value.trim()) {
this.textContent = '分析中...';
this.disabled = true;
setTimeout(() => {
this.textContent = '重新分析';
this.disabled = false;
analysisResult.style.display = 'block';
}, 2000);
}
});
const starItems = document.querySelectorAll('.star-item');
starItems.forEach(item => {
item.addEventListener('mouseenter', function() {
this.style.transform = 'translateY(-2px)';
this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
});
item.addEventListener('mouseleave', function() {
this.style.transform = 'translateY(0)';
this.style.boxShadow = 'none';
});
});
});
</script>
</body>
</html>