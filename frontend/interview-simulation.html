<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¨¡æ‹Ÿé¢è¯• - æ™ºèƒ½é¢è¯•è¯„åˆ†ç³»ç»Ÿ</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#2196F3',secondary:'#FF5722'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: "Noto Sans SC", "Roboto", sans-serif;
}
.code-editor {
font-family: "Consolas", "Monaco", "Courier New", monospace;
}
.code-editor:focus {
outline: none;
}
.volume-indicator {
width: 3px;
height: 15px;
background-color: #2196F3;
margin: 0 1px;
border-radius: 1px;
transition: height 0.1s ease;
}
.avatar-pulse {
animation: pulse 2s infinite;
}
@keyframes pulse {
0% {
box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4);
}
70% {
box-shadow: 0 0 0 10px rgba(33, 150, 243, 0);
}
100% {
box-shadow: 0 0 0 0 rgba(33, 150, 243, 0);
}
}
.network-indicator {
display: inline-block;
width: 8px;
height: 8px;
border-radius: 50%;
background-color: #4CAF50;
}
.custom-switch {
position: relative;
display: inline-block;
width: 44px;
height: 24px;
}
.custom-switch input {
opacity: 0;
width: 0;
height: 0;
}
.switch-slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #e5e7eb;
transition: .4s;
border-radius: 24px;
}
.switch-slider:before {
position: absolute;
content: "";
height: 18px;
width: 18px;
left: 3px;
bottom: 3px;
background-color: white;
transition: .4s;
border-radius: 50%;
}
input:checked + .switch-slider {
background-color: #2196F3;
}
input:checked + .switch-slider:before {
transform: translateX(20px);
}
.progress-bar {
height: 4px;
background-color: #e5e7eb;
border-radius: 2px;
overflow: hidden;
}
.progress-value {
height: 100%;
background-color: #2196F3;
border-radius: 2px;
transition: width 0.3s ease;
}
.settings-tab.active {
color: #2196F3;
border-color: #2196F3;
}
.transition-all {
transition: all 0.3s ease;
}
.detection-card-disabled {
opacity: 0.5;
transform: scale(0.98);
pointer-events: none;
}
.detection-card-disabled .bg-green-500 {
background-color: #9ca3af !important;
}
.detection-card-disabled .bg-primary {
width: 0% !important;
}
.question-area-disabled {
opacity: 0.5;
transform: scale(0.98);
filter: grayscale(0.5);
}
</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header class="bg-white shadow-sm z-50 py-3 px-4">
<div class="container mx-auto flex justify-between items-center">
<div class="flex items-center">
<a href="https://readdy.ai/home/95b52a2e-78c3-4162-b2e2-e2497cd401ae/9d12dac0-e378-427b-bddd-5b98bbd9222d" data-readdy="true" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 cursor-pointer">
<i class="ri-arrow-left-line text-gray-700"></i>
</a>
<div class="ml-4 flex items-center">
<span class="text-gray-700 font-medium">é¢è¯•è¿›åº¦ï¼š</span>
<span class="ml-2 text-primary font-medium">3/10</span>
</div>
</div>
<div class="flex items-center space-x-4">
<button class="px-3 py-1.5 !rounded-button bg-gray-100 hover:bg-gray-200 text-gray-700 flex items-center cursor-pointer whitespace-nowrap" id="toggle-tips">
<i class="ri-lightbulb-line mr-1"></i>
<span>å›ç­”æç¤º</span>
</button>
<button class="px-3 py-1.5 !rounded-button bg-gray-100 hover:bg-gray-200 text-gray-700 flex items-center cursor-pointer whitespace-nowrap" id="toggle-reference">
<i class="ri-book-2-line mr-1"></i>
<span>å‚è€ƒèµ„æ–™</span>
</button>
<button class="px-3 py-1.5 !rounded-button bg-gray-100 hover:bg-gray-200 text-gray-700 flex items-center cursor-pointer whitespace-nowrap" id="toggle-skills">
<i class="ri-star-line mr-1"></i>
<span>é¢è¯•æŠ€å·§</span>
</button>
<button class="px-3 py-1.5 !rounded-button bg-gray-100 hover:bg-gray-200 text-gray-700 flex items-center cursor-pointer whitespace-nowrap" id="toggle-coding">
<i class="ri-code-line mr-1"></i>
<span>ç¼–ç¨‹ç­”é¢˜</span>
</button>
</div>
<div class="flex items-center space-x-6">
<div class="flex items-center">
<span class="text-gray-700 mr-2">ç½‘ç»œçŠ¶æ€ï¼š</span>
<span class="network-indicator"></span>
<span class="ml-1 text-sm text-gray-700">è‰¯å¥½</span>
</div>
<div class="flex items-center">
<i class="ri-time-line text-gray-700 mr-2"></i>
<span class="text-gray-900 font-medium" id="timer">12:45</span>
</div>
<button class="bg-red-100 text-red-600 px-3 py-1.5 !rounded-button flex items-center hover:bg-red-200 transition-colors whitespace-nowrap cursor-pointer">
<i class="ri-error-warning-line mr-1"></i>
<span>ç´§æ€¥æ±‚åŠ©</span>
</button>
</div>
</div>
</header>
<!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
<main class="flex-1 flex overflow-hidden relative" style="height: calc(100vh - 8.5rem)">
<!-- å·¦ä¾§å†…å®¹åŒºåŸŸ -->
<div class="flex-1 flex flex-col p-6 transition-all duration-300 overflow-y-auto" id="main-content">
<button id="toggle-panel" class="absolute right-0 top-1/2 -translate-y-1/2 w-6 h-24 bg-white border border-gray-200 rounded-l-lg shadow-sm flex items-center justify-center hover:bg-gray-50 z-10 cursor-pointer">
<i class="ri-arrow-right-s-line text-gray-500" id="panel-arrow"></i>
</button>
<!-- é¢è¯•å®˜åŒºåŸŸ -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-6 transition-all duration-300" id="interviewer-area">
<div class="flex items-start">
<div class="w-16 h-16 rounded-full bg-primary bg-opacity-10 flex items-center justify-center avatar-pulse mr-4">
<i class="ri-user-line ri-xl text-primary"></i>
</div>
<div class="flex-1">
<div class="flex justify-between items-center mb-2">
<h3 class="text-lg font-medium text-gray-900">ææ•™æˆ (AIé¢è¯•å®˜)</h3>
<div class="flex items-center">
<div class="flex space-x-0.5 mr-2">
<div class="volume-indicator" style="height: 5px;"></div>
<div class="volume-indicator" style="height: 10px;"></div>
<div class="volume-indicator" style="height: 15px;"></div>
<div class="volume-indicator" style="height: 8px;"></div>
<div class="volume-indicator" style="height: 4px;"></div>
</div>
<span class="text-xs text-gray-500">æ­£åœ¨è¯´è¯</span>
</div>
</div>
  <div class="bg-gray-50 p-4 rounded-lg transition-all duration-300" id="question-display">
    <!-- æ¬¢è¿åŒºåŸŸ -->
    <div id="welcome-section">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">æ¬¢è¿æ¥åˆ°æ™ºèƒ½é¢è¯•ç³»ç»Ÿï¼ğŸ‰</h3>
      <p class="text-gray-600 mb-3">æ‚¨å¥½ï¼æˆ‘æ˜¯ææ•™æˆï¼Œæ‚¨çš„AIé¢è¯•å®˜ã€‚æ ¹æ®æ‚¨çš„ç®€å†åˆ†æç»“æœï¼Œæˆ‘å·²ç»ä¸ºæ‚¨å‡†å¤‡äº†ä¸ªæ€§åŒ–çš„é¢è¯•é¢˜ç›®ã€‚</p>
      <p class="text-gray-600 mb-3">æœ¬æ¬¡é¢è¯•å°†åŒ…å«<span id="interview-stats" class="font-medium text-primary"></span>ã€‚</p>
      <p class="text-gray-600 mb-4">åœ¨å¼€å§‹æ­£å¼é¢è¯•ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„è®¾å¤‡å·¥ä½œæ­£å¸¸ï¼Œç¯å¢ƒå®‰é™ï¼Œç„¶åç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹é¢è¯•ã€‚</p>
      <div class="text-center">
        <button id="start-interview-btn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium">
          <i class="ri-play-line mr-2"></i>å¼€å§‹æ­£å¼é¢è¯•
        </button>
      </div>
    </div>

    <!-- é¢è¯•é¢˜ç›®åŒºåŸŸ -->
    <div id="interview-section" class="hidden">
      <p id="interview-question" class="text-gray-800 leading-relaxed"></p>
      <div class="mt-4 flex justify-between items-center">
        <div class="text-sm text-gray-500">
          ç¬¬ <span id="current-question-index">1</span> é¢˜ / å…± <span id="total-questions">0</span> é¢˜
        </div>
        <div class="flex space-x-2">
          <button id="prev-question" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50" disabled>
            <i class="ri-arrow-left-line mr-1"></i>ä¸Šä¸€é¢˜
          </button>
          <button id="next-question" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">
            ä¸‹ä¸€é¢˜<i class="ri-arrow-right-line ml-1"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
<!-- ç”¨æˆ·æ‘„åƒå¤´åŒºåŸŸ -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-6 transition-all duration-300" id="camera-area" style="height: 400px;">
<div class="relative w-full h-full">
<div class="absolute inset-0 bg-gray-900 rounded-lg overflow-hidden">
<video id="user-video" class="w-full h-full object-cover" autoplay muted></video>
</div>
<div class="absolute bottom-4 right-4 flex space-x-2">
<button class="w-10 h-10 bg-black bg-opacity-50 hover:bg-opacity-70 rounded-full flex items-center justify-center text-white transition-colors cursor-pointer">
<i class="ri-fullscreen-line"></i>
</button>
<button class="w-10 h-10 bg-black bg-opacity-50 hover:bg-opacity-70 rounded-full flex items-center justify-center text-white transition-colors cursor-pointer">
<i class="ri-camera-line"></i>
</button>
<button class="w-10 h-10 bg-black bg-opacity-50 hover:bg-opacity-70 rounded-full flex items-center justify-center text-white transition-colors cursor-pointer">
<i class="ri-mic-line"></i>
</button>
</div>
</div>
</div>
<!-- ç¼–ç¨‹é¢˜ç­”é¢˜åŒºåŸŸ -->
<div class="bg-white rounded-lg shadow-sm p-6 hidden transition-all duration-300" id="coding-area">
<h3 class="text-lg font-medium text-gray-900 mb-3">ç¼–ç¨‹é¢˜è§£ç­”</h3>
<div class="mb-3 flex space-x-2">
<button class="px-3 py-1 bg-primary text-white !rounded-button whitespace-nowrap cursor-pointer">Python</button>
<button class="px-3 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200 !rounded-button whitespace-nowrap cursor-pointer">JavaScript</button>
<button class="px-3 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200 !rounded-button whitespace-nowrap cursor-pointer">Java</button>
<button class="px-3 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200 !rounded-button whitespace-nowrap cursor-pointer">C++</button>
</div>
<div class="bg-gray-900 rounded-lg p-4 text-white">
<pre class="code-editor" contenteditable="true" spellcheck="false">def backpropagation(network, X, y, learning_rate):
# å‰å‘ä¼ æ’­
output = forward_propagation(network, X)
# è®¡ç®—è¾“å‡ºå±‚çš„è¯¯å·®
output_error = y - output
output_delta = output_error * sigmoid_derivative(output)
# åå‘ä¼ æ’­è¯¯å·®
for layer in reversed(range(len(network) - 1)):
# è®¡ç®—å½“å‰å±‚çš„è¯¯å·®
current_layer = network[layer]
next_layer = network[layer + 1]
# è®¡ç®—å½“å‰å±‚çš„delta
current_delta = np.dot(next_layer['weights'].T, next_layer['delta']) * sigmoid_derivative(current_layer['output'])
# æ›´æ–°æƒé‡å’Œåç½®
current_layer['weights'] += learning_rate * np.outer(current_delta, current_layer['input'])
current_layer['bias'] += learning_rate * current_delta
return network</pre>
</div>
<div class="mt-3 flex justify-end">
<button class="bg-primary text-white px-4 py-2 !rounded-button hover:bg-opacity-90 transition-colors whitespace-nowrap cursor-pointer">
è¿è¡Œä»£ç 
</button>
</div>
</div>
</div>
<!-- å³ä¾§å®æ—¶æŒ‡æ ‡åŒºåŸŸ -->
<div class="bg-gray-50 p-6 border-l border-gray-200 overflow-y-auto transition-all duration-300" id="right-panel" style="width: 30%;">
<!-- è¡¨æƒ…æ£€æµ‹ -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-6 transition-all duration-300" id="expression-card">
<div class="flex items-center justify-between mb-4">
<h3 class="font-medium text-gray-900">è¡¨æƒ…æ£€æµ‹</h3>
<div class="flex items-center">
<div class="w-2 h-2 bg-green-500 rounded-full mr-2 transition-colors duration-300"></div>
<span class="text-sm text-gray-500 transition-colors duration-300">å®æ—¶æ£€æµ‹ä¸­</span>
</div>
</div>
<div class="space-y-3">
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-gray-700">å½“å‰è¡¨æƒ…</span>
<span class="text-primary font-medium" data-metric="expression">è‡ªç„¶</span>
</div>
<div class="h-2 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="expression-confidence" style="width: 85%"></div>
</div>
<div class="flex justify-between mt-1">
<span class="text-xs text-gray-500">ç½®ä¿¡åº¦</span>
<span class="text-xs text-gray-700">85%</span>
</div>
</div>
<div class="flex flex-wrap gap-2 mt-3">
<span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700">å¾®ç¬‘ 12%</span>
<span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700">ä¸“æ³¨ 8%</span>
<span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700">æ€è€ƒ 5%</span>
</div>
</div>
</div>
<!-- åŠ¨ä½œæ£€æµ‹ -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-6 transition-all duration-300" id="motion-card">
<div class="flex items-center justify-between mb-4">
<h3 class="font-medium text-gray-900">åŠ¨ä½œæ£€æµ‹</h3>
<div class="flex items-center">
<div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
<span class="text-sm text-gray-500">å®æ—¶æ£€æµ‹ä¸­</span>
</div>
</div>
<div class="space-y-3">
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-gray-700">å½“å‰å§¿æ€</span>
<span class="text-primary font-medium" data-metric="posture">æ­£å</span>
</div>
<div class="h-2 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="posture-confidence" style="width: 92%"></div>
</div>
<div class="flex justify-between mt-1">
<span class="text-xs text-gray-500">ç½®ä¿¡åº¦</span>
<span class="text-xs text-gray-700">92%</span>
</div>
</div>
<div class="flex flex-wrap gap-2 mt-3">
<span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700">æ‰‹åŠ¿æ´»è·ƒåº¦ ä¸­ç­‰</span>
<span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700">è§†çº¿äº¤äº’ è‰¯å¥½</span>
</div>
</div>
</div>
<!-- è¯­éŸ³æƒ…æ„Ÿåˆ†æ -->
<div class="bg-white rounded-lg shadow-sm p-6 transition-all duration-300" id="voice-card">
<div class="flex items-center justify-between mb-4">
<h3 class="font-medium text-gray-900">è¯­éŸ³æƒ…æ„Ÿåˆ†æ</h3>
<div class="flex items-center">
<div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
<span class="text-sm text-gray-500">å®æ—¶åˆ†æä¸­</span>
</div>
</div>
<div class="space-y-4">
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-gray-700">å½“å‰æƒ…æ„Ÿ</span>
<span class="text-primary font-medium" data-metric="voice-emotion">è‡ªä¿¡</span>
</div>
<div class="h-2 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="voice-confidence" style="width: 88%"></div>
</div>
<div class="flex justify-between mt-1">
<span class="text-xs text-gray-500">ç½®ä¿¡åº¦</span>
<span class="text-xs text-gray-700">88%</span>
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-sm text-gray-700">è¯­é€Ÿ</span>
<span class="text-sm text-primary">é€‚ä¸­</span>
</div>
<div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="voice-speed" style="width: 75%"></div>
</div>
</div>
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-sm text-gray-700">éŸ³è°ƒ</span>
<span class="text-sm text-primary">è‡ªç„¶</span>
</div>
<div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="voice-pitch" style="width: 82%"></div>
</div>
</div>
<div>
<div class="flex justify-between items-center mb-1">
<span class="text-sm text-gray-700">æ¸…æ™°åº¦</span>
<span class="text-sm text-primary">ä¼˜ç§€</span>
</div>
<div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300" data-metric="voice-clarity" style="width: 90%"></div>
</div>
</div>
</div>
<div class="mt-4">
<h4 class="text-sm font-medium text-gray-900 mb-2">å®æ—¶è¯­éŸ³è¯†åˆ«</h4>
<div class="bg-gray-50 p-3 rounded-lg text-sm text-gray-700 h-20 overflow-y-auto">
åå‘ä¼ æ’­ç®—æ³•æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç®—æ³•ï¼Œå®ƒé€šè¿‡è®¡ç®—æŸå¤±å‡½æ•°å¯¹å„å±‚å‚æ•°çš„æ¢¯åº¦æ¥æ›´æ–°ç½‘ç»œæƒé‡...
</div>
</div>
</div>
</div>
</div>
</main>
<!-- åº•éƒ¨æ§åˆ¶æ  -->
<footer class="bg-white border-t border-gray-200 py-4 px-6">
<div class="container mx-auto flex justify-between items-center">
<div class="flex items-center space-x-4">
<button class="bg-primary text-white px-4 py-2 !rounded-button flex items-center hover:bg-opacity-90 transition-colors whitespace-nowrap cursor-pointer">
<i class="ri-pause-line mr-1"></i>
<span>æš‚åœé¢è¯•</span>
</button>
<button class="bg-red-500 text-white px-4 py-2 !rounded-button flex items-center hover:bg-opacity-90 transition-colors whitespace-nowrap cursor-pointer">
<i class="ri-close-line mr-1"></i>
<span>ç»“æŸé¢è¯•</span>
</button>
</div>
<div class="flex items-center space-x-6">
<div class="flex items-center">
<span class="text-gray-700 mr-2">éº¦å…‹é£</span>
<label class="custom-switch cursor-pointer">
<input type="checkbox" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center">
<span class="text-gray-700 mr-2">æ‘„åƒå¤´</span>
<label class="custom-switch cursor-pointer">
<input type="checkbox" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center">
<span class="text-gray-700 mr-2">å…¨å±</span>
<label class="custom-switch cursor-pointer">
<input type="checkbox">
<span class="switch-slider"></span>
</label>
</div>
<button id="settings-btn" class="bg-gray-100 text-gray-700 px-4 py-2 !rounded-button flex items-center hover:bg-gray-200 transition-colors whitespace-nowrap cursor-pointer">
<i class="ri-settings-line mr-1"></i>
<span>è®¾ç½®</span>
</button>
</div>
</div>
</footer>
<!-- é…ç½®é¢æ¿ -->
<div id="settings-panel" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
<div class="bg-white rounded-lg w-[480px] p-6 transition-all duration-300">
<div class="flex justify-between items-center mb-6">
<h2 class="text-xl font-medium text-gray-900">é¢è¯•è®¾ç½®</h2>
<button class="text-gray-500 hover:text-gray-700 cursor-pointer" id="close-settings">
<i class="ri-close-line text-xl"></i>
</button>
</div>
<div class="border-b border-gray-200 mb-6">
<div class="flex space-x-6">
<button class="settings-tab active pb-3 px-2 text-primary border-b-2 border-primary cursor-pointer">æ£€æµ‹é…ç½®</button>
<button class="settings-tab pb-3 px-2 text-gray-500 border-b-2 border-transparent cursor-pointer">ç•Œé¢è®¾ç½®</button>
<button class="settings-tab pb-3 px-2 text-gray-500 border-b-2 border-transparent cursor-pointer">å…¶ä»–è®¾ç½®</button>
</div>
</div>
<div class="space-y-6">
<div class="flex items-center justify-between">
<div>
<h3 class="font-medium text-gray-900">é¢è¯•å®˜é—®é¢˜æ˜¾ç¤º</h3>
<p class="text-sm text-gray-500 mt-1">æ˜¾ç¤ºé¢è¯•å®˜æé—®çš„æ–‡æœ¬å†…å®¹</p>
</div>
<label class="custom-switch cursor-pointer">
<input type="checkbox" id="question-toggle" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center justify-between">
<div>
<h3 class="font-medium text-gray-900">è¡¨æƒ…æ£€æµ‹</h3>
<p class="text-sm text-gray-500 mt-1">å®æ—¶åˆ†æé¢éƒ¨è¡¨æƒ…å˜åŒ–</p>
</div>
<label class="custom-switch cursor-pointer">
<input type="checkbox" id="expression-toggle" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center justify-between">
<div>
<h3 class="font-medium text-gray-900">åŠ¨ä½œæ£€æµ‹</h3>
<p class="text-sm text-gray-500 mt-1">ç›‘æµ‹è‚¢ä½“è¯­è¨€å’Œå§¿æ€å˜åŒ–</p>
</div>
<label class="custom-switch cursor-pointer">
<input type="checkbox" id="motion-toggle" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center justify-between">
<div>
<h3 class="font-medium text-gray-900">è¯­éŸ³æƒ…æ„Ÿåˆ†æ</h3>
<p class="text-sm text-gray-500 mt-1">åˆ†æè¯­éŸ³æƒ…æ„Ÿå’Œè¯­è¨€ç‰¹å¾</p>
</div>
<label class="custom-switch cursor-pointer">
<input type="checkbox" id="voice-toggle" checked>
<span class="switch-slider"></span>
</label>
</div>
<div class="flex items-center justify-between">
<div>
<h3 class="font-medium text-gray-900">å®æ—¶æç¤º</h3>
<p class="text-sm text-gray-500 mt-1">æ˜¾ç¤ºå›ç­”å»ºè®®å’Œå‚è€ƒè¦ç‚¹</p>
</div>
<label class="custom-switch cursor-pointer">
<input type="checkbox" id="tips-toggle" checked>
<span class="switch-slider"></span>
</label>
</div>
</div>
<div class="mt-6 pt-6 border-t border-gray-200 flex space-x-3">
<button class="flex-1 bg-gray-100 text-gray-700 px-4 py-2 !rounded-button hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap" id="reset-settings">
æ¢å¤é»˜è®¤
</button>
<button class="flex-1 bg-primary text-white px-4 py-2 !rounded-button hover:bg-opacity-90 transition-colors cursor-pointer whitespace-nowrap" id="save-settings">
ä¿å­˜è®¾ç½®
</button>
</div>
</div>
</div>
<script id="timer-script">
document.addEventListener('DOMContentLoaded', function() {
let seconds = 0;
let minutes = 0;
function updateTimer() {
seconds++;
if (seconds >= 60) {
seconds = 0;
minutes++;
}
const formattedMinutes = minutes.toString().padStart(2, '0');
const formattedSeconds = seconds.toString().padStart(2, '0');
document.getElementById('timer').textContent = `${formattedMinutes}:${formattedSeconds}`;
}
setInterval(updateTimer, 1000);
});
</script>
<script id="camera-script">
document.addEventListener('DOMContentLoaded', function() {
const userVideo = document.getElementById('user-video');
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
.then(function(stream) {
userVideo.srcObject = stream;
})
.catch(function(err) {
console.error('æ— æ³•è®¿é—®æ‘„åƒå¤´æˆ–éº¦å…‹é£:', err);
});
});
</script>
<script id="panel-control-script">
document.addEventListener('DOMContentLoaded', function() {
const mainContent = document.getElementById('main-content');
const rightPanel = document.getElementById('right-panel');
const toggleButton = document.getElementById('toggle-panel');
const panelArrow = document.getElementById('panel-arrow');
let isPanelVisible = true;
function togglePanel() {
isPanelVisible = !isPanelVisible;
if (isPanelVisible) {
rightPanel.style.width = '30%';
rightPanel.style.opacity = '1';
mainContent.style.paddingRight = '24px';
panelArrow.classList.remove('ri-arrow-left-s-line');
panelArrow.classList.add('ri-arrow-right-s-line');
} else {
rightPanel.style.width = '0';
rightPanel.style.opacity = '0';
mainContent.style.paddingRight = '48px';
panelArrow.classList.remove('ri-arrow-right-s-line');
panelArrow.classList.add('ri-arrow-left-s-line');
}
}
toggleButton.addEventListener('click', togglePanel);
function updateMetrics() {
const metrics = {
expression: {
current: ['è‡ªç„¶', 'å¾®ç¬‘', 'ä¸“æ³¨', 'æ€è€ƒ'],
confidence: [85, 12, 8, 5]
},
posture: {
current: 'æ­£å',
confidence: 92,
details: ['æ‰‹åŠ¿æ´»è·ƒåº¦ ä¸­ç­‰', 'è§†çº¿äº¤äº’ è‰¯å¥½']
},
voice: {
emotion: 'è‡ªä¿¡',
confidence: 88,
speed: 75,
pitch: 82,
clarity: 90
}
};
const randomIndex = Math.floor(Math.random() * metrics.expression.current.length);
const currentExpression = metrics.expression.current[randomIndex];
const currentConfidence = metrics.expression.confidence[randomIndex];
const expressionElement = document.querySelector('[data-metric="expression"]');
const expressionConfidenceElement = document.querySelector('[data-metric="expression-confidence"]');
const postureElement = document.querySelector('[data-metric="posture"]');
const postureConfidenceElement = document.querySelector('[data-metric="posture-confidence"]');
const voiceEmotionElement = document.querySelector('[data-metric="voice-emotion"]');
const voiceConfidenceElement = document.querySelector('[data-metric="voice-confidence"]');
const voiceSpeedElement = document.querySelector('[data-metric="voice-speed"]');
const voicePitchElement = document.querySelector('[data-metric="voice-pitch"]');
const voiceClarityElement = document.querySelector('[data-metric="voice-clarity"]');
if (expressionElement) expressionElement.textContent = currentExpression;
if (expressionConfidenceElement) expressionConfidenceElement.style.width = `${currentConfidence}%`;
if (postureElement) postureElement.textContent = metrics.posture.current;
if (postureConfidenceElement) postureConfidenceElement.style.width = `${metrics.posture.confidence}%`;
if (voiceEmotionElement) voiceEmotionElement.textContent = metrics.voice.emotion;
if (voiceConfidenceElement) voiceConfidenceElement.style.width = `${metrics.voice.confidence}%`;
if (voiceSpeedElement) voiceSpeedElement.style.width = `${metrics.voice.speed}%`;
if (voicePitchElement) voicePitchElement.style.width = `${metrics.voice.pitch}%`;
if (voiceClarityElement) voiceClarityElement.style.width = `${metrics.voice.clarity}%`;
}
setInterval(updateMetrics, 2000);
});
</script>
<script id="audio-visualization-script">
document.addEventListener('DOMContentLoaded', function() {
const volumeIndicators = document.querySelectorAll('.volume-indicator');
function animateVolumeIndicators() {
volumeIndicators.forEach(indicator => {
const randomHeight = Math.floor(Math.random() * 15) + 3;
indicator.style.height = `${randomHeight}px`;
});
}
setInterval(animateVolumeIndicators, 200);
});
</script>
<script id="settings-script">
document.addEventListener('DOMContentLoaded', function() {
const settingsBtn = document.getElementById('settings-btn');
const settingsPanel = document.getElementById('settings-panel');
const closeSettings = document.getElementById('close-settings');
const saveSettings = document.getElementById('save-settings');
const resetSettings = document.getElementById('reset-settings');
const questionToggle = document.getElementById('question-toggle');
const expressionToggle = document.getElementById('expression-toggle');
const motionToggle = document.getElementById('motion-toggle');
const voiceToggle = document.getElementById('voice-toggle');
const tipsToggle = document.getElementById('tips-toggle');
const settingsTabs = document.querySelectorAll('.settings-tab');
const questionDisplay = document.getElementById('question-display');
const interviewerArea = document.getElementById('interviewer-area');
const cameraArea = document.getElementById('camera-area');
const expressionCard = document.getElementById('expression-card');
const motionCard = document.getElementById('motion-card');
const voiceCard = document.getElementById('voice-card');
const rightPanel = document.getElementById('right-panel');
const defaultSettings = {
question: true,
expression: true,
motion: true,
voice: true,
tips: true
};
function adjustLayout() {
const questionEnabled = questionToggle.checked;
const expressionEnabled = expressionToggle.checked;
const motionEnabled = motionToggle.checked;
const voiceEnabled = voiceToggle.checked;
let enabledCount = 0;
if (expressionEnabled) enabledCount++;
if (motionEnabled) enabledCount++;
if (voiceEnabled) enabledCount++;
if (questionEnabled) {
cameraArea.style.height = '400px';
} else {
cameraArea.style.height = '500px';
}
const rightPanelHeight = window.innerHeight - 136;
const cardHeight = enabledCount > 0 ? Math.floor((rightPanelHeight - (enabledCount * 24)) / enabledCount) : 0;
if (expressionCard && expressionEnabled) {
expressionCard.style.height = `${cardHeight}px`;
expressionCard.style.overflow = 'hidden';
}
if (motionCard && motionEnabled) {
motionCard.style.height = `${cardHeight}px`;
motionCard.style.overflow = 'hidden';
}
if (voiceCard && voiceEnabled) {
voiceCard.style.height = `${cardHeight}px`;
voiceCard.style.overflow = 'hidden';
}
}
function updateCard(card, isEnabled) {
if (!card) return;
if (isEnabled) {
card.classList.remove('detection-card-disabled');
card.style.display = 'block';
const statusDot = card.querySelector('.w-2.h-2');
const statusText = card.querySelector('.text-sm.text-gray-500');
if (statusDot && statusText) {
statusDot.classList.remove('bg-gray-400');
statusDot.classList.add('bg-green-500');
statusText.textContent = card === voiceCard ? 'å®æ—¶åˆ†æä¸­' : 'å®æ—¶æ£€æµ‹ä¸­';
}
const progressBars = card.querySelectorAll('.bg-primary');
progressBars.forEach(bar => {
const originalWidth = bar.getAttribute('data-width') || bar.style.width || '85%';
bar.setAttribute('data-width', originalWidth);
bar.style.width = originalWidth;
});
} else {
card.classList.add('detection-card-disabled');
card.style.display = 'none';
const statusDot = card.querySelector('.w-2.h-2');
const statusText = card.querySelector('.text-sm.text-gray-500');
if (statusDot && statusText) {
statusDot.classList.remove('bg-green-500');
statusDot.classList.add('bg-gray-400');
statusText.textContent = 'å·²å…³é—­';
}
const progressBars = card.querySelectorAll('.bg-primary');
progressBars.forEach(bar => {
bar.style.width = '0%';
});
}
}
function applySettings() {
if (questionDisplay) {
if (questionToggle.checked) {
questionDisplay.classList.remove('question-area-disabled');
questionDisplay.style.display = 'block';
} else {
questionDisplay.classList.add('question-area-disabled');
questionDisplay.style.display = 'none';
}
}
updateCard(expressionCard, expressionToggle.checked);
updateCard(motionCard, motionToggle.checked);
updateCard(voiceCard, voiceToggle.checked);
adjustLayout();
}
function resetToDefault() {
questionToggle.checked = defaultSettings.question;
expressionToggle.checked = defaultSettings.expression;
motionToggle.checked = defaultSettings.motion;
voiceToggle.checked = defaultSettings.voice;
tipsToggle.checked = defaultSettings.tips;
applySettings();
}
settingsTabs.forEach(tab => {
tab.addEventListener('click', () => {
settingsTabs.forEach(t => {
t.classList.remove('active', 'text-primary', 'border-primary');
t.classList.add('text-gray-500', 'border-transparent');
});
tab.classList.add('active', 'text-primary', 'border-primary');
tab.classList.remove('text-gray-500', 'border-transparent');
});
});
settingsBtn.addEventListener('click', () => {
settingsPanel.classList.remove('hidden');
});
closeSettings.addEventListener('click', () => {
settingsPanel.classList.add('hidden');
});
settingsPanel.addEventListener('click', (e) => {
if (e.target === settingsPanel) {
settingsPanel.classList.add('hidden');
}
});
saveSettings.addEventListener('click', () => {
applySettings();
settingsPanel.classList.add('hidden');
});
resetSettings.addEventListener('click', resetToDefault);
questionToggle.addEventListener('change', applySettings);
expressionToggle.addEventListener('change', applySettings);
motionToggle.addEventListener('change', applySettings);
voiceToggle.addEventListener('change', applySettings);
applySettings();
window.addEventListener('resize', adjustLayout);
});
</script>
<script id="feature-toggle-script">
document.addEventListener('DOMContentLoaded', function() {
const features = {
'toggle-tips': document.querySelector('.bg-white.rounded-lg.shadow-sm.p-6.mb-6:has(h3:contains("å›ç­”è¦ç‚¹æç¤º"))'),
'toggle-reference': document.querySelector('.bg-white.rounded-lg.shadow-sm.overflow-hidden.mb-6'),
'toggle-skills': document.querySelector('.bg-white.rounded-lg.shadow-sm.p-6:has(h3:contains("é¢è¯•æŠ€å·§"))'),
'toggle-coding': document.getElementById('coding-area')
};
const buttons = {
'toggle-tips': document.getElementById('toggle-tips'),
'toggle-reference': document.getElementById('toggle-reference'),
'toggle-skills': document.getElementById('toggle-skills'),
'toggle-coding': document.getElementById('toggle-coding')
};
Object.keys(features).forEach(id => {
if (buttons[id] && features[id]) {
features[id].classList.add('hidden');
buttons[id].addEventListener('click', function() {
features[id].classList.toggle('hidden');
this.classList.toggle('bg-primary');
this.classList.toggle('text-white');
this.classList.toggle('bg-gray-100');
this.classList.toggle('text-gray-700');
});
}
});
let isRecording = false;
const endButton = document.querySelector('button:has(i.ri-close-line)');
endButton.addEventListener('click', function() {
if (!isRecording) return;
isRecording = false;
const reportDialog = document.createElement('div');
reportDialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
reportDialog.innerHTML = `
<div class="bg-white rounded-lg w-[800px] max-h-[80vh] overflow-y-auto p-6">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-medium text-gray-900">é¢è¯•è¯„æµ‹æŠ¥å‘Š</h2>
<button class="text-gray-500 hover:text-gray-700 cursor-pointer" onclick="this.closest('.fixed').remove()">
<i class="ri-close-line text-xl"></i>
</button>
</div>
<div class="space-y-6">
<div class="bg-gray-50 p-4 rounded-lg">
<h3 class="font-medium text-gray-900 mb-2">æ•´ä½“è¡¨ç°è¯„åˆ†</h3>
<div class="flex items-center space-x-2">
<div class="text-3xl font-medium text-primary">92</div>
<div class="text-gray-500">/ 100</div>
</div>
</div>
<div>
<h3 class="font-medium text-gray-900 mb-3">è¯¦ç»†è¯„ä¼°</h3>
<div class="space-y-4">
<div class="flex justify-between items-center">
<span class="text-gray-700">ä¸“ä¸šçŸ¥è¯†æŒæ¡</span>
<div class="w-48 h-2 bg-gray-200 rounded-full overflow-hidden">
<div class="h-full bg-primary" style="width: 95%"></div>
</div>
<span class="text-gray-900">95%</span>
</div>
<div class="flex justify-between items-center">
<span class="text-gray-700">è¡¨è¾¾èƒ½åŠ›</span>
<div class="w-48 h-2 bg-gray-200 rounded-full overflow-hidden">
<div class="h-full bg-primary" style="width: 88%"></div>
</div>
<span class="text-gray-900">88%</span>
</div>
<div class="flex justify-between items-center">
<span class="text-gray-700">é€»è¾‘æ€ç»´</span>
<div class="w-48 h-2 bg-gray-200 rounded-full overflow-hidden">
<div class="h-full bg-primary" style="width: 92%"></div>
</div>
<span class="text-gray-900">92%</span>
</div>
</div>
</div>
<div>
<h3 class="font-medium text-gray-900 mb-3">é—®é¢˜å›ç­”åˆ†æ</h3>
<div class="space-y-4">
<div class="bg-gray-50 p-4 rounded-lg">
<div class="flex justify-between mb-2">
<span class="font-medium text-gray-900">é—®é¢˜ 1ï¼šæ·±åº¦å­¦ä¹ ä¸­çš„åå‘ä¼ æ’­ç®—æ³•</span>
<span class="text-primary">å¾—åˆ†ï¼š95</span>
</div>
<p class="text-gray-700 text-sm">å›ç­”å…¨é¢å‡†ç¡®ï¼Œå¾ˆå¥½åœ°è§£é‡Šäº†ç®—æ³•åŸç†å’Œåº”ç”¨åœºæ™¯ã€‚å»ºè®®å¯ä»¥è¡¥å……æ›´å¤šå®é™…æ¡ˆä¾‹ã€‚</p>
</div>
<div class="bg-gray-50 p-4 rounded-lg">
<div class="flex justify-between mb-2">
<span class="font-medium text-gray-900">é—®é¢˜ 2ï¼šç¥ç»ç½‘ç»œä¼˜åŒ–æ–¹æ³•</span>
<span class="text-primary">å¾—åˆ†ï¼š90</span>
</div>
<p class="text-gray-700 text-sm">å¯¹å„ç§ä¼˜åŒ–ç®—æ³•çš„æ¯”è¾ƒåˆ†æåˆ°ä½ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ·±å…¥è®¨è®ºè¶…å‚æ•°é€‰æ‹©ã€‚</p>
</div>
</div>
</div>
<div>
<h3 class="font-medium text-gray-900 mb-3">æ”¹è¿›å»ºè®®</h3>
<ul class="list-disc list-inside space-y-2 text-gray-700">
<li>åœ¨å›ç­”æŠ€æœ¯é—®é¢˜æ—¶å¯ä»¥å¤šä¸¾ä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­</li>
<li>å¯¹äºå¤æ‚æ¦‚å¿µçš„è§£é‡Šå¯ä»¥é€‚å½“ä½¿ç”¨ç±»æ¯”æ¥å¢åŠ ç†è§£åº¦</li>
<li>å›ç­”é—®é¢˜æ—¶çš„è¯­é€Ÿå¯ä»¥ç¨å¾®æ”¾æ…¢ä¸€äº›</li>
</ul>
</div>
</div>
<div class="mt-6 flex justify-end">
<button class="bg-primary text-white px-4 py-2 !rounded-button hover:bg-opacity-90 transition-colors cursor-pointer whitespace-nowrap">
ä¸‹è½½å®Œæ•´æŠ¥å‘Š
</button>
</div>
</div>
`;
document.body.appendChild(reportDialog);
});
const startButton = document.querySelector('button:has(i.ri-pause-line)');
startButton.addEventListener('click', function() {
isRecording = !isRecording;
const icon = this.querySelector('i');
const text = this.querySelector('span');
if (isRecording) {
icon.classList.remove('ri-pause-line');
icon.classList.add('ri-play-line');
text.textContent = 'ç»§ç»­é¢è¯•';
} else {
icon.classList.remove('ri-play-line');
icon.classList.add('ri-pause-line');
text.textContent = 'æš‚åœé¢è¯•';
}
  });
  });
  </script>

  <script id="auth-check">
  document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('access_token');
    if (!token) {
      window.location.href = '/frontend/login.html';
      return;
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    fetchAndShowUserInfo();
  });

  async function fetchAndShowUserInfo() {
    const token = localStorage.getItem('access_token');
    if (!token) return;
    
    try {
      const resp = await fetch('/api/v1/profile', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      
      if (!resp.ok) {
        throw new Error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
      }
      
      const user = await resp.json();
      console.log('âœ… ç”¨æˆ·éªŒè¯æˆåŠŸ:', user.name);
    } catch (error) {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      localStorage.removeItem('access_token');
      window.location.href = '/frontend/login.html';  
    }
  }
  </script>

  <script id="interview-manager">
  // Redisé¢è¯•ç®¡ç†å™¨ - ä»Redisè·å–é¢˜ç›®å¹¶æ¸²æŸ“
  class RedisInterviewManager {
      constructor() {
          this.questions = [];
          this.currentQuestionIndex = 0;
          this.sessionId = '';
          this.isInterviewStarted = false;
          
          this.init();
      }
      
      init() {
          // è§£æURLå‚æ•°è·å–session_id
          const urlParams = new URLSearchParams(window.location.search);
          this.sessionId = urlParams.get('session_id') || localStorage.getItem('interview_session_id') || '';
          
          if (!this.sessionId) {
              this.showErrorMessage('æœªæ‰¾åˆ°é¢è¯•ä¼šè¯IDï¼Œè¯·ä»é¢˜ç›®ç”Ÿæˆé¡µé¢é‡æ–°å¼€å§‹');
              return;
          }
          
          console.log('ğŸ¯ åˆå§‹åŒ–é¢è¯•ç®¡ç†å™¨ï¼Œsession_id:', this.sessionId);
          
          // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
          this.displayWelcome();
          
          // ç»‘å®šäº‹ä»¶
          this.bindEvents();
      }
      
      displayWelcome() {
          const statsElement = document.getElementById('interview-stats');
          if (statsElement) {
              statsElement.innerHTML = '<strong>æ­£åœ¨åŠ è½½é¢è¯•ä¿¡æ¯...</strong>';
          }
      }
      
      bindEvents() {
          const startBtn = document.getElementById('start-interview-btn');
          const prevBtn = document.getElementById('prev-question');
          const nextBtn = document.getElementById('next-question');
          
          if (startBtn) {
              startBtn.addEventListener('click', () => this.startFormalInterview());
          }
          
          if (prevBtn) {
              prevBtn.addEventListener('click', () => this.prevQuestion());
          }
          
          if (nextBtn) {
              nextBtn.addEventListener('click', () => this.nextQuestion());
          }
      }
      
      async startFormalInterview() {
          const startBtn = document.getElementById('start-interview-btn');
          
          if (startBtn) {
              startBtn.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>æ­£åœ¨åŠ è½½é¢˜ç›®...';
              startBtn.disabled = true;
          }
          
          try {
              // ä»Redisè·å–é¢˜ç›®
              await this.loadQuestionsFromRedis();
              
              // æ˜¾ç¤ºé¢è¯•ç•Œé¢
              this.showInterviewSection();
              
              // æ˜¾ç¤ºç¬¬ä¸€é¢˜
              this.displayCurrentQuestion();
              
              this.isInterviewStarted = true;
              
              console.log('âœ… æ­£å¼é¢è¯•å¼€å§‹ï¼Œé¢˜ç›®åŠ è½½æˆåŠŸ');
              
          } catch (error) {
              console.error('âŒ å¼€å§‹é¢è¯•å¤±è´¥:', error);
              alert('é¢˜ç›®åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•ï¼š' + error.message);
              
              if (startBtn) {
                  startBtn.innerHTML = '<i class="ri-play-line mr-2"></i>å¼€å§‹æ­£å¼é¢è¯•';
                  startBtn.disabled = false;
              }
          }
      }
      
      async loadQuestionsFromRedis() {
          try {
              console.log('ğŸ” ä»Redisè·å–é¢˜ç›®ï¼Œsession_id:', this.sessionId);
              
              const response = await fetch('/api/v1/questions/session', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ session_id: this.sessionId })
              });
              
              const result = await response.json();
              
              if (!result.success) {
                  throw new Error(result.message || 'è·å–é¢˜ç›®å¤±è´¥');
              }
              
              this.questions = result.questions || [];
              
              if (this.questions.length === 0) {
                  throw new Error('æœªæ‰¾åˆ°é¢è¯•é¢˜ç›®');
              }
              
              console.log(`âœ… æˆåŠŸä»Redisè·å– ${this.questions.length} é“é¢˜ç›®`);
              
              // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
              this.updateInterviewStats(result.stats);
              
              return this.questions;
              
          } catch (error) {
              console.error('âŒ ä»Redisè·å–é¢˜ç›®å¤±è´¥:', error);
              throw error;
          }
      }
      
      updateInterviewStats(stats) {
          const statsElement = document.getElementById('interview-stats');
          if (statsElement && stats) {
              const difficulty = stats.difficulty_level || 2;
              const difficultyLabels = { 1: 'åˆçº§', 2: 'ä¸­çº§', 3: 'é«˜çº§' };
              
              statsElement.innerHTML = `
                  <strong>${stats.total_questions || this.questions.length}</strong>é“é¢˜ç›®ï¼Œ
                  éš¾åº¦ç­‰çº§ï¼š<strong>${difficultyLabels[difficulty]}</strong>
              `;
          }
      }
      
      showInterviewSection() {
          const welcomeSection = document.getElementById('welcome-section');
          const interviewSection = document.getElementById('interview-section');
          
          if (welcomeSection && interviewSection) {
              welcomeSection.classList.add('hidden');
              interviewSection.classList.remove('hidden');
              
              // æ›´æ–°æ€»é¢˜ç›®æ•°
              const totalQuestions = document.getElementById('total-questions');
              if (totalQuestions) {
                  totalQuestions.textContent = this.questions.length;
              }
          }
      }
      
      displayCurrentQuestion() {
          if (!this.questions || this.questions.length === 0) {
              console.error('âŒ æ²¡æœ‰é¢˜ç›®å¯æ˜¾ç¤º');
              return;
          }
          
          const currentQuestion = this.questions[this.currentQuestionIndex];
          const questionElement = document.getElementById('interview-question');
          const indexElement = document.getElementById('current-question-index');
          
          if (questionElement && currentQuestion) {
              questionElement.textContent = currentQuestion.title || currentQuestion.question || 'é¢˜ç›®åŠ è½½å¤±è´¥';
              console.log(`ğŸ“‹ æ˜¾ç¤ºç¬¬ ${this.currentQuestionIndex + 1} é¢˜:`, currentQuestion.title || currentQuestion.question);
          }
          
          if (indexElement) {
              indexElement.textContent = this.currentQuestionIndex + 1;
          }
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          this.updateNavigationButtons();
      }
      
      updateNavigationButtons() {
          const prevBtn = document.getElementById('prev-question');
          const nextBtn = document.getElementById('next-question');
          
          if (prevBtn) {
              prevBtn.disabled = this.currentQuestionIndex === 0;
          }
          
          if (nextBtn) {
              if (this.currentQuestionIndex >= this.questions.length - 1) {
                  nextBtn.innerHTML = 'ç»“æŸé¢è¯•<i class="ri-check-line ml-1"></i>';
                  nextBtn.classList.remove('bg-primary');
                  nextBtn.classList.add('bg-green-600');
              } else {
                  nextBtn.innerHTML = 'ä¸‹ä¸€é¢˜<i class="ri-arrow-right-line ml-1"></i>';
                  nextBtn.classList.remove('bg-green-600');
                  nextBtn.classList.add('bg-primary');
              }
          }
      }
      
      nextQuestion() {
          if (this.currentQuestionIndex >= this.questions.length - 1) {
              this.endInterview();
              return;
          }
          
          this.currentQuestionIndex++;
          this.displayCurrentQuestion();
          console.log(`â¡ï¸ ç§»åŠ¨åˆ°ç¬¬ ${this.currentQuestionIndex + 1} é¢˜`);
      }
      
      prevQuestion() {
          if (this.currentQuestionIndex > 0) {
              this.currentQuestionIndex--;
              this.displayCurrentQuestion();
              console.log(`â¬…ï¸ è¿”å›ç¬¬ ${this.currentQuestionIndex + 1} é¢˜`);
          }
      }
      
      endInterview() {
          console.log('ğŸ‰ é¢è¯•ç»“æŸ');
          
          // æ˜¾ç¤ºé¢è¯•ç»“æŸæç¤º
          const dialog = document.createElement('div');
          dialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          dialog.innerHTML = `
              <div class="bg-white rounded-lg p-8 max-w-md mx-4">
                  <div class="text-center">
                      <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                          <i class="ri-check-line text-2xl text-green-600"></i>
                      </div>
                      <h3 class="text-xl font-semibold text-gray-900 mb-2">é¢è¯•å®Œæˆï¼</h3>
                      <p class="text-gray-600 mb-6">æ­å–œæ‚¨å®Œæˆäº†æ‰€æœ‰é¢è¯•é¢˜ç›®ï¼Œæ‚¨çš„è¡¨ç°å¾ˆæ£’ï¼</p>
                      <div class="flex space-x-3">
                          <button class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50" onclick="window.location.href='./setting_page1.html'">
                              è¿”å›é¦–é¡µ
                          </button>
                          <button class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90" onclick="this.closest('.fixed').remove()">
                              æŸ¥çœ‹è¯„ä¼°
                          </button>
                      </div>
                  </div>
              </div>
          `;
          
          document.body.appendChild(dialog);
          
          // æ¸…ç†Redisä¸­çš„é¢è¯•ä¼šè¯ï¼ˆå¯é€‰ï¼‰
          this.cleanupSession();
      }
      
      async cleanupSession() {
          try {
              await fetch(`/api/v1/questions/session/${this.sessionId}`, {
                  method: 'DELETE'
              });
              
              // æ¸…ç†localStorage
              localStorage.removeItem('interview_session_id');
              
              console.log('âœ… é¢è¯•ä¼šè¯æ¸…ç†å®Œæˆ');
          } catch (error) {
              console.warn('âš ï¸ é¢è¯•ä¼šè¯æ¸…ç†å¤±è´¥:', error);
          }
      }
      
      showErrorMessage(message) {
          const statsElement = document.getElementById('interview-stats');
          if (statsElement) {
              statsElement.innerHTML = `<span class="text-red-600"><strong>é”™è¯¯:</strong> ${message}</span>`;
          }
          
          const startBtn = document.getElementById('start-interview-btn');
          if (startBtn) {
              startBtn.innerHTML = '<i class="ri-arrow-left-line mr-2"></i>è¿”å›é¢˜ç›®ç”Ÿæˆ';
              startBtn.onclick = () => window.location.href = './setting_page3.html';
          }
      }
  }

  // åˆå§‹åŒ–Redisé¢è¯•ç®¡ç†å™¨
  document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ¯ åˆå§‹åŒ–Redisé¢è¯•ç®¡ç†å™¨...');
      window.redisInterviewManager = new RedisInterviewManager();
  });
  </script>

  <script id="realtime-multimodal-analysis">
  // å®æ—¶å¤šæ¨¡æ€åˆ†æç®¡ç†å™¨
  class RealtimeMultimodalAnalyzer {
      constructor() {
          this.isAnalyzing = false;
          this.websocket = null;
          this.mediaStream = null;
          this.videoTrack = null;
          this.audioTrack = null;
          this.mediaRecorder = null;
          this.canvas = null;
          this.canvasContext = null;
          this.audioChunks = [];
          
          // åˆ†æé…ç½®
          this.config = {
              videoFPS: 2,          // è§†é¢‘åˆ†æå¸§ç‡ï¼ˆæ¯ç§’2å¸§ï¼‰
              audioInterval: 3000,  // éŸ³é¢‘åˆ†æé—´éš”ï¼ˆ3ç§’ï¼‰
              reconnectDelay: 5000, // WebSocketé‡è¿å»¶è¿Ÿ
              maxRetries: 3         // æœ€å¤§é‡è¯•æ¬¡æ•°
          };
          
          this.retryCount = 0;
          this.analysisIntervals = {
              video: null,
              audio: null
          };
          
          this.init();
      }
      
      async init() {
          console.log('ğŸ¯ åˆå§‹åŒ–å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨...');
          
          try {
              // åˆ›å»ºcanvasç”¨äºè§†é¢‘å¸§æˆªå–
              this.createCanvas();
              
              // è·å–åª’ä½“æµ
              await this.initMediaStream();
              
              // å»ºç«‹WebSocketè¿æ¥
              await this.connectWebSocket();
              
              console.log('âœ… å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨åˆå§‹åŒ–å®Œæˆ');
              
          } catch (error) {
              console.error('âŒ å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨åˆå§‹åŒ–å¤±è´¥:', error);
              this.handleError(error);
          }
      }
      
      createCanvas() {
          this.canvas = document.createElement('canvas');
          this.canvas.width = 640;
          this.canvas.height = 480;
          this.canvasContext = this.canvas.getContext('2d');
      }
      
      async initMediaStream() {
          const maxRetries = 20; // æœ€å¤šç­‰å¾…10ç§’ (20 * 500ms)
          let retries = 0;
          
          console.log('ğŸ¥ å¼€å§‹è·å–è§†é¢‘æµ...');
          
          // ç­‰å¾…è§†é¢‘æµå‡†å¤‡çš„è½®è¯¢æœºåˆ¶
          const waitForVideoStream = () => {
              return new Promise((resolve, reject) => {
                  const checkStream = () => {
                      const videoElement = document.getElementById('user-video');
                      
                      if (videoElement && videoElement.srcObject) {
                          const stream = videoElement.srcObject;
                          const videoTracks = stream.getVideoTracks();
                          const audioTracks = stream.getAudioTracks();
                          
                          if (videoTracks.length > 0 && audioTracks.length > 0) {
                              console.log('âœ… æ£€æµ‹åˆ°å®Œæ•´çš„éŸ³è§†é¢‘æµ');
                              resolve({
                                  stream: stream,
                                  videoTrack: videoTracks[0],
                                  audioTrack: audioTracks[0]
                              });
                              return;
                          }
                      }
                      
                      retries++;
                      if (retries >= maxRetries) {
                          console.error('âŒ ç­‰å¾…è§†é¢‘æµè¶…æ—¶');
                          reject(new Error(`ç­‰å¾…è§†é¢‘æµè¶…æ—¶ (${maxRetries * 500}ms)`));
                          return;
                      }
                      
                      console.log(`ğŸ”„ ç­‰å¾…è§†é¢‘æµå°±ç»ª... (${retries}/${maxRetries})`);
                      setTimeout(checkStream, 500);
                  };
                  
                  checkStream();
              });
          };
          
          try {
              // é¦–å…ˆå°è¯•ç›´æ¥è·å–
              const videoElement = document.getElementById('user-video');
              
              if (videoElement && videoElement.srcObject) {
                  const stream = videoElement.srcObject;
                  const videoTracks = stream.getVideoTracks();
                  const audioTracks = stream.getAudioTracks();
                  
                  if (videoTracks.length > 0 && audioTracks.length > 0) {
                      this.mediaStream = stream;
                      this.videoTrack = videoTracks[0];
                      this.audioTrack = audioTracks[0];
                      
                      console.log('âœ… åª’ä½“æµè·å–æˆåŠŸ (ç«‹å³å¯ç”¨)');
                      return;
                  }
              }
              
              // å¦‚æœæ²¡æœ‰ç«‹å³å¯ç”¨ï¼Œç­‰å¾…è§†é¢‘æµå‡†å¤‡
              console.log('â³ è§†é¢‘æµæœªå°±ç»ªï¼Œå¼€å§‹ç­‰å¾…...');
              const streamData = await waitForVideoStream();
              
              this.mediaStream = streamData.stream;
              this.videoTrack = streamData.videoTrack;
              this.audioTrack = streamData.audioTrack;
              
              console.log('âœ… åª’ä½“æµè·å–æˆåŠŸ (ç­‰å¾…åè·å¾—)');
              
              // éªŒè¯è§†é¢‘æµçŠ¶æ€
              this.validateMediaStream();
              
          } catch (error) {
              console.error('âŒ åª’ä½“æµåˆå§‹åŒ–å¤±è´¥:', error);
              
              // å°è¯•ä¸»åŠ¨è¯·æ±‚æ‘„åƒå¤´æƒé™
              await this.requestMediaPermissions();
              
              throw new Error(`è§†é¢‘æµè·å–å¤±è´¥: ${error.message}`);
          }
      }
      
      validateMediaStream() {
          if (!this.mediaStream) {
              throw new Error('åª’ä½“æµä¸ºç©º');
          }
          
          if (!this.videoTrack || this.videoTrack.readyState !== 'live') {
              throw new Error('è§†é¢‘è½¨é“ä¸å¯ç”¨');
          }
          
          if (!this.audioTrack || this.audioTrack.readyState !== 'live') {
              console.warn('âš ï¸ éŸ³é¢‘è½¨é“ä¸å¯ç”¨ï¼Œä»…è¿›è¡Œè§†é¢‘åˆ†æ');
          }
          
          console.log('âœ… åª’ä½“æµéªŒè¯é€šè¿‡', {
              videoTrack: this.videoTrack.label,
              audioTrack: this.audioTrack?.label || 'N/A',
              videoEnabled: this.videoTrack.enabled,
              audioEnabled: this.audioTrack?.enabled || false
          });
      }
      
      async requestMediaPermissions() {
          console.log('ğŸ” å°è¯•ä¸»åŠ¨è¯·æ±‚æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™...');
          
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ 
                  video: {
                      width: { ideal: 640 },
                      height: { ideal: 480 },
                      frameRate: { ideal: 30 }
                  }, 
                  audio: {
                      echoCancellation: true,
                      noiseSuppression: true
                  }
              });
              
              // å°†æ–°è·å–çš„æµè®¾ç½®åˆ°videoå…ƒç´ 
              const videoElement = document.getElementById('user-video');
              if (videoElement) {
                  videoElement.srcObject = stream;
                  
                  this.mediaStream = stream;
                  this.videoTrack = stream.getVideoTracks()[0];
                  this.audioTrack = stream.getAudioTracks()[0];
                  
                  console.log('âœ… ä¸»åŠ¨è¯·æ±‚åª’ä½“æƒé™æˆåŠŸ');
              }
              
          } catch (permissionError) {
              console.error('âŒ åª’ä½“æƒé™è¯·æ±‚å¤±è´¥:', permissionError);
              
              // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
              this.showPermissionError(permissionError);
              
              throw permissionError;
          }
      }
      
      showPermissionError(error) {
          let errorMessage = 'æ— æ³•è®¿é—®æ‘„åƒå¤´å’Œéº¦å…‹é£';
          let solution = 'è¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®å¹¶å…è®¸æ‘„åƒå¤´æƒé™';
          
          switch (error.name) {
              case 'NotAllowedError':
                  errorMessage = 'æ‘„åƒå¤´æƒé™è¢«æ‹’ç»';
                  solution = 'è¯·åœ¨æµè§ˆå™¨åœ°å€æ å·¦ä¾§ç‚¹å‡»æ‘„åƒå¤´å›¾æ ‡ï¼Œå…è®¸è®¿é—®æ‘„åƒå¤´å’Œéº¦å…‹é£';
                  break;
              case 'NotFoundError':
                  errorMessage = 'æœªæ£€æµ‹åˆ°æ‘„åƒå¤´è®¾å¤‡';
                  solution = 'è¯·ç¡®ä¿æ‘„åƒå¤´å·²æ­£ç¡®è¿æ¥å¹¶åœ¨å…¶ä»–åº”ç”¨ä¸­å¯ç”¨';
                  break;
              case 'NotReadableError':
                  errorMessage = 'æ‘„åƒå¤´æ­£è¢«å…¶ä»–åº”ç”¨å ç”¨';
                  solution = 'è¯·å…³é—­å…¶ä»–ä½¿ç”¨æ‘„åƒå¤´çš„åº”ç”¨ç¨‹åºåé‡è¯•';
                  break;
              default:
                  errorMessage = `åª’ä½“è®¾å¤‡é”™è¯¯: ${error.message}`;
                  break;
          }
          
          // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºé”™è¯¯æç¤º
          this.displayMediaError(errorMessage, solution);
      }
      
      displayMediaError(message, solution) {
          const rightPanel = document.getElementById('right-panel');
          if (rightPanel) {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4';
              errorDiv.innerHTML = `
                  <div class="flex items-start">
                      <i class="ri-camera-off-line text-yellow-600 mr-3 mt-1"></i>
                      <div class="flex-1">
                          <h4 class="text-sm font-medium text-yellow-800 mb-1">${message}</h4>
                          <p class="text-xs text-yellow-700 mb-2">${solution}</p>
                          <button 
                              onclick="location.reload()" 
                              class="text-xs bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-2 py-1 rounded">
                              åˆ·æ–°é¡µé¢é‡è¯•
                          </button>
                      </div>
                  </div>
              `;
              
              rightPanel.insertBefore(errorDiv, rightPanel.firstChild);
          }
      }
      
      async connectWebSocket() {
          return new Promise((resolve, reject) => {
              try {
                  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                  const wsUrl = `${protocol}//${window.location.host}/ws/multimodal-analysis`;
                  
                  this.websocket = new WebSocket(wsUrl);
                  
                  this.websocket.onopen = () => {
                      console.log('âœ… WebSocketè¿æ¥å·²å»ºç«‹');
                      this.retryCount = 0;
                      
                      // å‘é€è®¤è¯ä¿¡æ¯
                      this.sendAuthMessage();
                      
                      resolve();
                  };
                  
                  this.websocket.onmessage = (event) => {
                      this.handleAnalysisResult(JSON.parse(event.data));
                  };
                  
                  this.websocket.onclose = (event) => {
                      console.warn('âš ï¸ WebSocketè¿æ¥å·²å…³é—­:', event.code, event.reason);
                      this.handleDisconnection();
                  };
                  
                  this.websocket.onerror = (error) => {
                      console.error('âŒ WebSocketè¿æ¥é”™è¯¯:', error);
                      reject(error);
                  };
                  
                  // è¿æ¥è¶…æ—¶å¤„ç†
                  setTimeout(() => {
                      if (this.websocket.readyState !== WebSocket.OPEN) {
                          reject(new Error('WebSocketè¿æ¥è¶…æ—¶'));
                      }
                  }, 10000);
                  
              } catch (error) {
                  reject(error);
              }
          });
      }
      
      sendAuthMessage() {
          const sessionId = new URLSearchParams(window.location.search).get('session_id') || 
                          localStorage.getItem('interview_session_id');
          const token = localStorage.getItem('access_token');
          
          this.websocket.send(JSON.stringify({
              type: 'auth',
              data: {
                  session_id: sessionId,
                  access_token: token,
                  timestamp: Date.now()
              }
          }));
      }
      
      startAnalysis() {
          if (this.isAnalyzing) {
              console.log('âš ï¸ åˆ†æå·²ç»åœ¨è¿›è¡Œä¸­');
              return;
          }
          
          // éªŒè¯åª’ä½“æµçŠ¶æ€
          if (!this.mediaStream || !this.videoTrack) {
              console.error('âŒ åª’ä½“æµæœªå‡†å¤‡å¥½ï¼Œæ— æ³•å¯åŠ¨åˆ†æ');
              this.showVideoStreamError(new Error('åª’ä½“æµæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•'));
              return;
          }
          
          this.isAnalyzing = true;
          console.log('ğŸ” å¼€å§‹å®æ—¶å¤šæ¨¡æ€åˆ†æ');
          
          try {
              // å¼€å§‹è§†é¢‘å¸§åˆ†æ
              this.startVideoAnalysis();
              
              // å¼€å§‹éŸ³é¢‘åˆ†æ
              this.startAudioAnalysis();
              
              // å¯åŠ¨è§†é¢‘æµå¥åº·æ£€æŸ¥
              this.startVideoStreamHealthCheck();
              
              // æ›´æ–°UIçŠ¶æ€
              this.updateAnalysisStatus(true);
              
              // ç§»é™¤å¯èƒ½å­˜åœ¨çš„é”™è¯¯æç¤º
              const errorDivs = document.querySelectorAll('#right-panel .bg-red-50, #right-panel .bg-orange-50, #right-panel .bg-yellow-50, #right-panel .bg-blue-50');
              errorDivs.forEach(div => div.remove());
              
              console.log('âœ… å®æ—¶å¤šæ¨¡æ€åˆ†æå·²æˆåŠŸå¯åŠ¨');
              
          } catch (error) {
              console.error('âŒ å¯åŠ¨åˆ†ææ—¶å‡ºé”™:', error);
              this.isAnalyzing = false;
              this.handleError(error);
          }
      }
      
      stopAnalysis() {
          if (!this.isAnalyzing) {
              return;
          }
          
          this.isAnalyzing = false;
          console.log('â¹ï¸ åœæ­¢å®æ—¶å¤šæ¨¡æ€åˆ†æ');
          
          // æ¸…é™¤å®šæ—¶å™¨
          if (this.analysisIntervals.video) {
              clearInterval(this.analysisIntervals.video);
              this.analysisIntervals.video = null;
          }
          
          if (this.analysisIntervals.audio) {
              clearInterval(this.analysisIntervals.audio);
              this.analysisIntervals.audio = null;
          }
          
          // åœæ­¢éŸ³é¢‘å½•åˆ¶
          if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
              this.mediaRecorder.stop();
          }
          
          // æ›´æ–°UIçŠ¶æ€
          this.updateAnalysisStatus(false);
      }
      
      startVideoAnalysis() {
          if (!this.videoTrack) {
              console.error('âŒ è§†é¢‘è½¨é“ä¸å¯ç”¨');
              return;
          }
          
          const interval = 1000 / this.config.videoFPS; // è½¬æ¢ä¸ºæ¯«ç§’
          
          this.analysisIntervals.video = setInterval(() => {
              this.captureAndAnalyzeFrame();
          }, interval);
          
          console.log(`ğŸ¥ è§†é¢‘åˆ†æå·²å¯åŠ¨ï¼Œå¸§ç‡: ${this.config.videoFPS} FPS`);
      }
      
      captureAndAnalyzeFrame() {
          if (!this.isAnalyzing || !this.websocket || this.websocket.readyState !== WebSocket.OPEN) {
              return;
          }
          
          try {
              const videoElement = document.getElementById('user-video');
              
              if (videoElement && videoElement.videoWidth > 0 && videoElement.videoHeight > 0) {
                  // ç»˜åˆ¶å½“å‰å¸§åˆ°canvas
                  this.canvasContext.drawImage(
                      videoElement, 
                      0, 0, 
                      this.canvas.width, 
                      this.canvas.height
                  );
                  
                  // è½¬æ¢ä¸ºbase64
                  const frameData = this.canvas.toDataURL('image/jpeg', 0.8);
                  
                  // å‘é€åˆ°åç«¯åˆ†æ
                  this.websocket.send(JSON.stringify({
                      type: 'video_frame',
                      data: {
                          frame: frameData,
                          timestamp: Date.now(),
                          width: this.canvas.width,
                          height: this.canvas.height
                      }
                  }));
              }
              
          } catch (error) {
              console.error('âŒ è§†é¢‘å¸§æˆªå–å¤±è´¥:', error);
          }
      }
      
      startAudioAnalysis() {
          if (!this.audioTrack) {
              console.error('âŒ éŸ³é¢‘è½¨é“ä¸å¯ç”¨');
              return;
          }
          
          this.analysisIntervals.audio = setInterval(() => {
              this.captureAndAnalyzeAudio();
          }, this.config.audioInterval);
          
          console.log(`ğŸµ éŸ³é¢‘åˆ†æå·²å¯åŠ¨ï¼Œé—´éš”: ${this.config.audioInterval}ms`);
      }
      
      captureAndAnalyzeAudio() {
          if (!this.isAnalyzing || !this.websocket || this.websocket.readyState !== WebSocket.OPEN) {
              return;
          }
          
          try {
              // åˆ›å»ºæ–°çš„MediaRecorderç”¨äºå½•åˆ¶éŸ³é¢‘ç‰‡æ®µ
              const audioStream = new MediaStream([this.audioTrack]);
              this.mediaRecorder = new MediaRecorder(audioStream, {
                  mimeType: 'audio/webm;codecs=opus'
              });
              
              this.audioChunks = [];
              
              this.mediaRecorder.ondataavailable = (event) => {
                  if (event.data.size > 0) {
                      this.audioChunks.push(event.data);
                  }
              };
              
              this.mediaRecorder.onstop = () => {
                  if (this.audioChunks.length > 0) {
                      const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                      this.sendAudioForAnalysis(audioBlob);
                  }
              };
              
              // å½•åˆ¶3ç§’éŸ³é¢‘
              this.mediaRecorder.start();
              setTimeout(() => {
                  if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
                      this.mediaRecorder.stop();
                  }
              }, this.config.audioInterval);
              
          } catch (error) {
              console.error('âŒ éŸ³é¢‘å½•åˆ¶å¤±è´¥:', error);
          }
      }
      
      async sendAudioForAnalysis(audioBlob) {
          try {
              // è½¬æ¢ä¸ºbase64
              const reader = new FileReader();
              reader.onload = () => {
                  if (this.websocket && this.websocket.readyState === WebSocket.OPEN) {
                      this.websocket.send(JSON.stringify({
                          type: 'audio_chunk',
                          data: {
                              audio: reader.result.split(',')[1], // ç§»é™¤data:audio/webm;base64,å‰ç¼€
                              timestamp: Date.now(),
                              duration: this.config.audioInterval
                          }
                      }));
                  }
              };
              reader.readAsDataURL(audioBlob);
              
          } catch (error) {
              console.error('âŒ éŸ³é¢‘å‘é€å¤±è´¥:', error);
          }
      }
      
      handleAnalysisResult(message) {
          try {
              switch (message.type) {
                  case 'visual_analysis':
                      this.updateVisualMetrics(message.data);
                      break;
                      
                  case 'audio_analysis':
                      this.updateAudioMetrics(message.data);
                      break;
                      
                  case 'error':
                      console.error('âŒ åç«¯åˆ†æé”™è¯¯:', message.data);
                      break;
                      
                  case 'status':
                      console.log('ğŸ“Š åˆ†æçŠ¶æ€:', message.data);
                      break;
                      
                  default:
                      console.warn('âš ï¸ æœªçŸ¥æ¶ˆæ¯ç±»å‹:', message.type);
              }
              
          } catch (error) {
              console.error('âŒ å¤„ç†åˆ†æç»“æœå¤±è´¥:', error);
          }
      }
      
      updateVisualMetrics(visualData) {
          // æ›´æ–°è¡¨æƒ…æ£€æµ‹
          const expressionElement = document.querySelector('[data-metric="expression"]');
          const expressionConfidenceElement = document.querySelector('[data-metric="expression-confidence"]');
          
          if (expressionElement && visualData.dominant_emotion) {
              const emotionMap = {
                  'neutral': 'è‡ªç„¶',
                  'happy': 'å¾®ç¬‘',
                  'surprised': 'æƒŠè®¶',
                  'focused': 'ä¸“æ³¨',
                  'confused': 'å›°æƒ‘',
                  'thinking': 'æ€è€ƒ'
              };
              
              expressionElement.textContent = emotionMap[visualData.dominant_emotion] || 'è‡ªç„¶';
          }
          
          if (expressionConfidenceElement && visualData.emotion_confidence) {
              const confidence = Math.round(visualData.emotion_confidence * 100);
              expressionConfidenceElement.style.width = `${confidence}%`;
              
              // æ›´æ–°ç½®ä¿¡åº¦æ–‡æœ¬
              const confidenceText = expressionConfidenceElement.parentElement.nextElementSibling?.querySelector('.text-gray-700:last-child');
              if (confidenceText) {
                  confidenceText.textContent = `${confidence}%`;
              }
          }
          
          // æ›´æ–°åŠ¨ä½œæ£€æµ‹
          const postureElement = document.querySelector('[data-metric="posture"]');
          const postureConfidenceElement = document.querySelector('[data-metric="posture-confidence"]');
          
          if (postureElement && visualData.head_pose_stability) {
              const poseStability = visualData.head_pose_stability;
              const poseText = poseStability > 0.8 ? 'æ­£å' : poseStability > 0.6 ? 'è½»å¾®å€¾æ–œ' : 'å§¿æ€ä¸ç¨³';
              postureElement.textContent = poseText;
          }
          
          if (postureConfidenceElement && visualData.head_pose_stability) {
              const stability = Math.round(visualData.head_pose_stability * 100);
              postureConfidenceElement.style.width = `${stability}%`;
              
              // æ›´æ–°ç½®ä¿¡åº¦æ–‡æœ¬
              const stabilityText = postureConfidenceElement.parentElement.nextElementSibling?.querySelector('.text-gray-700:last-child');
              if (stabilityText) {
                  stabilityText.textContent = `${stability}%`;
              }
          }
          
          console.log('ğŸ¥ è§†è§‰æŒ‡æ ‡å·²æ›´æ–°:', visualData);
      }
      
      updateAudioMetrics(audioData) {
          // æ›´æ–°è¯­éŸ³æƒ…æ„Ÿ
          const voiceEmotionElement = document.querySelector('[data-metric="voice-emotion"]');
          const voiceConfidenceElement = document.querySelector('[data-metric="voice-confidence"]');
          
          if (voiceEmotionElement && audioData.emotion) {
              const emotionMap = {
                  'confident': 'è‡ªä¿¡',
                  'calm': 'å¹³é™',
                  'nervous': 'ç´§å¼ ',
                  'excited': 'å…´å¥‹',
                  'uncertain': 'ä¸ç¡®å®š'
              };
              
              voiceEmotionElement.textContent = emotionMap[audioData.emotion] || 'å¹³é™';
          }
          
          if (voiceConfidenceElement && audioData.emotion_confidence) {
              const confidence = Math.round(audioData.emotion_confidence * 100);
              voiceConfidenceElement.style.width = `${confidence}%`;
              
              // æ›´æ–°ç½®ä¿¡åº¦æ–‡æœ¬
              const confidenceText = voiceConfidenceElement.parentElement.nextElementSibling?.querySelector('.text-gray-700:last-child');
              if (confidenceText) {
                  confidenceText.textContent = `${confidence}%`;
              }
          }
          
          // æ›´æ–°è¯­é€Ÿ
          const voiceSpeedElement = document.querySelector('[data-metric="voice-speed"]');
          if (voiceSpeedElement && audioData.speech_rate) {
              const speedPercentage = Math.min(100, Math.max(0, (audioData.speech_rate / 200) * 100));
              voiceSpeedElement.style.width = `${speedPercentage}%`;
          }
          
          // æ›´æ–°éŸ³è°ƒ
          const voicePitchElement = document.querySelector('[data-metric="voice-pitch"]');
          if (voicePitchElement && audioData.pitch_variance) {
              const pitchPercentage = Math.min(100, Math.max(0, (audioData.pitch_variance / 50) * 100));
              voicePitchElement.style.width = `${pitchPercentage}%`;
          }
          
          // æ›´æ–°æ¸…æ™°åº¦
          const voiceClarityElement = document.querySelector('[data-metric="voice-clarity"]');
          if (voiceClarityElement && audioData.clarity_score) {
              const clarity = Math.round(audioData.clarity_score * 100);
              voiceClarityElement.style.width = `${clarity}%`;
          }
          
          console.log('ğŸµ éŸ³é¢‘æŒ‡æ ‡å·²æ›´æ–°:', audioData);
      }
      
      updateAnalysisStatus(isActive) {
          const statusDots = document.querySelectorAll('#expression-card .w-2.h-2, #motion-card .w-2.h-2, #voice-card .w-2.h-2');
          const statusTexts = document.querySelectorAll('#expression-card .text-sm.text-gray-500:last-child, #motion-card .text-sm.text-gray-500:last-child, #voice-card .text-sm.text-gray-500:last-child');
          
          statusDots.forEach(dot => {
              if (isActive) {
                  dot.classList.remove('bg-gray-400');
                  dot.classList.add('bg-green-500');
              } else {
                  dot.classList.remove('bg-green-500');
                  dot.classList.add('bg-gray-400');
              }
          });
          
          statusTexts.forEach((text, index) => {
              if (isActive) {
                  text.textContent = index === 2 ? 'å®æ—¶åˆ†æä¸­' : 'å®æ—¶æ£€æµ‹ä¸­';
              } else {
                  text.textContent = 'å·²æš‚åœ';
              }
          });
      }
      
      handleDisconnection() {
          if (this.retryCount < this.config.maxRetries) {
              this.retryCount++;
              console.log(`ğŸ”„ WebSocketé‡è¿å°è¯• ${this.retryCount}/${this.config.maxRetries}...`);
              
              setTimeout(() => {
                  this.connectWebSocket().catch(error => {
                      console.error('âŒ WebSocketé‡è¿å¤±è´¥:', error);
                  });
              }, this.config.reconnectDelay);
          } else {
              console.error('âŒ WebSocketè¿æ¥å·²æ–­å¼€ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°');
              this.stopAnalysis();
              this.showConnectionError();
          }
      }
      
      showConnectionError() {
          // åœ¨å³ä¾§é¢æ¿æ˜¾ç¤ºè¿æ¥é”™è¯¯æç¤º
          const rightPanel = document.getElementById('right-panel');
          if (rightPanel) {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-4 mb-4';
              errorDiv.innerHTML = `
                  <div class="flex items-center">
                      <i class="ri-wifi-off-line text-red-500 mr-2"></i>
                      <div>
                          <h4 class="text-sm font-medium text-red-800">å®æ—¶åˆ†æå·²æ–­å¼€</h4>
                          <p class="text-xs text-red-600 mt-1">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•</p>
                      </div>
                  </div>
              `;
              
              rightPanel.insertBefore(errorDiv, rightPanel.firstChild);
          }
      }
      
      handleError(error) {
          console.error('âŒ å¤šæ¨¡æ€åˆ†æå™¨é”™è¯¯:', error);
          
          // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„å¤„ç†æ–¹å¼
          if (error.message.includes('è§†é¢‘æµ')) {
              // è§†é¢‘æµç›¸å…³é”™è¯¯ - æ˜¾ç¤ºè¯¦ç»†çš„ç”¨æˆ·æŒ‡å¯¼
              this.showVideoStreamError(error);
          } else if (error.message.includes('WebSocket')) {
              // WebSocketè¿æ¥ç›¸å…³é”™è¯¯
              this.showConnectionError();
          } else {
              // å…¶ä»–é€šç”¨é”™è¯¯
              this.showGenericError(error);
          }
          
          // ä¸ç«‹å³å›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®ï¼Œè€Œæ˜¯ç»™ç”¨æˆ·é€‰æ‹©
          this.showRetryOptions();
      }
      
      showVideoStreamError(error) {
          const rightPanel = document.getElementById('right-panel');
          if (rightPanel) {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-4 mb-4';
              errorDiv.innerHTML = `
                  <div class="flex items-start">
                      <i class="ri-camera-off-line text-red-600 mr-3 mt-1"></i>
                      <div class="flex-1">
                          <h4 class="text-sm font-medium text-red-800 mb-2">æ‘„åƒå¤´è·å–å¤±è´¥</h4>
                          <p class="text-xs text-red-700 mb-3">${error.message}</p>
                          <div class="space-y-2">
                              <button 
                                  onclick="this.parentElement.parentElement.parentElement.parentElement.remove(); location.reload()" 
                                  class="block w-full text-xs bg-red-100 hover:bg-red-200 text-red-800 px-3 py-2 rounded">
                                  ğŸ”„ åˆ·æ–°é¡µé¢é‡è¯•
                              </button>
                              <button 
                                  onclick="this.parentElement.parentElement.parentElement.parentElement.remove(); window.realtimeAnalyzer.fallbackToSimulation()" 
                                  class="block w-full text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded">
                                  ğŸ“Š ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ç»§ç»­
                              </button>
                          </div>
                      </div>
                  </div>
              `;
              
              rightPanel.insertBefore(errorDiv, rightPanel.firstChild);
          }
      }
      
      showGenericError(error) {
          const rightPanel = document.getElementById('right-panel');
          if (rightPanel) {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4';
              errorDiv.innerHTML = `
                  <div class="flex items-start">
                      <i class="ri-error-warning-line text-orange-600 mr-3 mt-1"></i>
                      <div class="flex-1">
                          <h4 class="text-sm font-medium text-orange-800 mb-1">åˆ†æå™¨åˆå§‹åŒ–å¤±è´¥</h4>
                          <p class="text-xs text-orange-700 mb-2">${error.message || 'æœªçŸ¥é”™è¯¯'}</p>
                          <button 
                              onclick="this.parentElement.parentElement.parentElement.remove(); window.realtimeAnalyzer.retryInitialization()" 
                              class="text-xs bg-orange-100 hover:bg-orange-200 text-orange-800 px-2 py-1 rounded">
                              ğŸ”„ é‡è¯•åˆå§‹åŒ–
                          </button>
                      </div>
                  </div>
              `;
              
              rightPanel.insertBefore(errorDiv, rightPanel.firstChild);
          }
      }
      
      showRetryOptions() {
          // åœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„é‡è¯•é€‰é¡¹
          console.log(`
ğŸ”§ å®æ—¶åˆ†ææ•…éšœæ’æŸ¥æŒ‡å—:

1. ğŸ“¹ æ£€æŸ¥æ‘„åƒå¤´æƒé™
   - ç¡®ä¿æµè§ˆå™¨å·²è·å¾—æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™
   - æ£€æŸ¥åœ°å€æ å·¦ä¾§æ˜¯å¦æœ‰æ‘„åƒå¤´å›¾æ ‡è¢«é˜»æ­¢

2. ğŸ”Œ æ£€æŸ¥è®¾å¤‡è¿æ¥
   - ç¡®ä¿æ‘„åƒå¤´è®¾å¤‡æ­£å¸¸è¿æ¥
   - å°è¯•åœ¨å…¶ä»–åº”ç”¨ä¸­ä½¿ç”¨æ‘„åƒå¤´æµ‹è¯•

3. ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®ä¿WebSocketè¿æ¥æ­£å¸¸
   - æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢è¿æ¥

4. ğŸ”„ åˆ·æ–°é¡µé¢é‡è¯•
   - æœ‰æ—¶å€™ç®€å•çš„é¡µé¢åˆ·æ–°å°±èƒ½è§£å†³é—®é¢˜

5. ğŸ“Š ä¸´æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
   - å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ç»§ç»­ä½“éªŒ

å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚
          `);
      }
      
      async retryInitialization() {
          console.log('ğŸ”„ é‡è¯•å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨åˆå§‹åŒ–...');
          
          try {
              // é‡ç½®çŠ¶æ€
              this.isAnalyzing = false;
              this.websocket = null;
              this.mediaStream = null;
              this.videoTrack = null;
              this.audioTrack = null;
              
              // é‡æ–°åˆå§‹åŒ–
              await this.init();
              
              console.log('âœ… é‡è¯•åˆå§‹åŒ–æˆåŠŸ');
              
              // ç§»é™¤é”™è¯¯æç¤º
              const errorDivs = document.querySelectorAll('#right-panel .bg-red-50, #right-panel .bg-orange-50, #right-panel .bg-yellow-50');
              errorDivs.forEach(div => div.remove());
              
          } catch (error) {
              console.error('âŒ é‡è¯•åˆå§‹åŒ–å¤±è´¥:', error);
              this.showGenericError(new Error('é‡è¯•åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ'));
          }
      }
      
      fallbackToSimulation() {
          console.log('ğŸ”„ å›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼');
          
          // æ˜¾ç¤ºæ¨¡æ‹Ÿæ¨¡å¼æç¤º
          this.showSimulationModeNotice();
          
          // ä½¿ç”¨åŸæœ‰çš„updateMetricså‡½æ•°
          if (typeof updateMetrics === 'function') {
              setInterval(updateMetrics, 2000);
              console.log('âœ… æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼å·²å¯åŠ¨');
          } else {
              console.warn('âš ï¸ updateMetricså‡½æ•°ä¸å¯ç”¨ï¼Œå¯åŠ¨å¤‡ç”¨æ¨¡æ‹Ÿ');
              this.startBackupSimulation();
          }
      }
      
      showSimulationModeNotice() {
          const rightPanel = document.getElementById('right-panel');
          if (rightPanel) {
              const noticeDiv = document.createElement('div');
              noticeDiv.className = 'bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4';
              noticeDiv.innerHTML = `
                  <div class="flex items-start">
                      <i class="ri-play-circle-line text-blue-600 mr-3 mt-1"></i>
                      <div class="flex-1">
                          <h4 class="text-sm font-medium text-blue-800 mb-1">æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼</h4>
                          <p class="text-xs text-blue-700 mb-2">æ­£åœ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæ¼”ç¤ºï¼Œæ•°æ®ä¼šå®šæœŸæ›´æ–°ä½†ä¸åæ˜ çœŸå®çŠ¶æ€</p>
                          <button 
                              onclick="window.realtimeAnalyzer.retryInitialization()" 
                              class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-800 px-2 py-1 rounded">
                              ğŸ”„ é‡è¯•çœŸå®åˆ†æ
                          </button>
                      </div>
                  </div>
              `;
              
              rightPanel.insertBefore(noticeDiv, rightPanel.firstChild);
          }
      }
      
      startBackupSimulation() {
          // å¤‡ç”¨çš„æ¨¡æ‹Ÿæ•°æ®æ›´æ–°é€»è¾‘
          const updateInterval = setInterval(() => {
              try {
                  // æ¨¡æ‹Ÿè¡¨æƒ…å˜åŒ–
                  const expressions = ['è‡ªç„¶', 'å¾®ç¬‘', 'ä¸“æ³¨', 'æ€è€ƒ', 'å¹³é™'];
                  const randomExpression = expressions[Math.floor(Math.random() * expressions.length)];
                  const expressionElement = document.querySelector('[data-metric="expression"]');
                  if (expressionElement) {
                      expressionElement.textContent = randomExpression;
                  }
                  
                  // æ¨¡æ‹Ÿç½®ä¿¡åº¦å˜åŒ–
                  const confidence = Math.floor(Math.random() * 30) + 70; // 70-100%
                  const expressionConfidenceElement = document.querySelector('[data-metric="expression-confidence"]');
                  if (expressionConfidenceElement) {
                      expressionConfidenceElement.style.width = `${confidence}%`;
                  }
                  
                  // æ¨¡æ‹Ÿè¯­éŸ³æƒ…æ„Ÿ
                  const emotions = ['è‡ªä¿¡', 'å¹³é™', 'ä¸“ä¸š', 'çƒ­æƒ…'];
                  const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                  const voiceEmotionElement = document.querySelector('[data-metric="voice-emotion"]');
                  if (voiceEmotionElement) {
                      voiceEmotionElement.textContent = randomEmotion;
                  }
                  
                  console.log('ğŸ“Š å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®å·²æ›´æ–°');
                  
              } catch (error) {
                  console.error('âŒ å¤‡ç”¨æ¨¡æ‹Ÿæ›´æ–°å¤±è´¥:', error);
                  clearInterval(updateInterval);
              }
          }, 3000);
          
          console.log('âœ… å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼å·²å¯åŠ¨');
      }
      
      // æ·»åŠ è§†é¢‘æµå¥åº·æ£€æŸ¥
      startVideoStreamHealthCheck() {
          if (!this.videoTrack) return;
          
          const healthCheckInterval = setInterval(() => {
              if (!this.videoTrack || this.videoTrack.readyState !== 'live') {
                  console.warn('âš ï¸ è§†é¢‘è½¨é“çŠ¶æ€å¼‚å¸¸ï¼Œå°è¯•æ¢å¤...');
                  clearInterval(healthCheckInterval);
                  
                  // å°è¯•é‡æ–°è·å–åª’ä½“æµ
                  this.requestMediaPermissions().catch(error => {
                      console.error('âŒ è§†é¢‘æµæ¢å¤å¤±è´¥:', error);
                      this.showVideoStreamError(new Error('è§†é¢‘æµæ„å¤–ä¸­æ–­'));
                  });
              }
          }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
          
          // 5åˆ†é’Ÿååœæ­¢å¥åº·æ£€æŸ¥ï¼ˆé¿å…æ— é™è¿è¡Œï¼‰
          setTimeout(() => {
              clearInterval(healthCheckInterval);
              console.log('â¹ï¸ è§†é¢‘æµå¥åº·æ£€æŸ¥å·²åœæ­¢');
          }, 5 * 60 * 1000);
          
          console.log('âœ… è§†é¢‘æµå¥åº·æ£€æŸ¥å·²å¯åŠ¨');
      }
      
      // å…¬å…±æ–¹æ³•
      toggleAnalysis() {
          if (this.isAnalyzing) {
              this.stopAnalysis();
          } else {
              this.startAnalysis();
          }
      }
      
      destroy() {
          this.stopAnalysis();
          
          if (this.websocket) {
              this.websocket.close();
              this.websocket = null;
          }
          
          console.log('ğŸ—‘ï¸ å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨å·²é”€æ¯');
      }
  }

  // å…¨å±€åˆ†æå™¨å®ä¾‹
  let realtimeAnalyzer = null;

  // åˆå§‹åŒ–å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨
  document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å®æ—¶å¤šæ¨¡æ€åˆ†æå™¨...');
      
      // ç«‹å³åˆå§‹åŒ–åˆ†æå™¨
      realtimeAnalyzer = new RealtimeMultimodalAnalyzer();
      
      // ä½¿ç”¨è½®è¯¢æ–¹å¼ç¡®ä¿æ­£ç¡®é›†æˆ
      function integrateWithInterviewManager() {
          if (window.redisInterviewManager && window.redisInterviewManager.startFormalInterview) {
              console.log('ğŸ”— é›†æˆå®æ—¶åˆ†æå™¨ä¸é¢è¯•ç®¡ç†å™¨');
              
              // ä¿å­˜åŸå§‹æ–¹æ³•
              const originalMethod = window.redisInterviewManager.startFormalInterview;
              
              // è¦†ç›–æ–¹æ³•ï¼Œæ·»åŠ å®æ—¶åˆ†æå¯åŠ¨
              window.redisInterviewManager.startFormalInterview = async function() {
                  console.log('ğŸ¯ å¼€å§‹æ­£å¼é¢è¯• - å‡†å¤‡å¯åŠ¨å®æ—¶åˆ†æ');
                  
                  // è°ƒç”¨åŸå§‹æ–¹æ³•
                  await originalMethod.call(this);
                  
                  // ç¡®è®¤é¢è¯•å·²å¼€å§‹åå¯åŠ¨å®æ—¶åˆ†æ
                  if (realtimeAnalyzer && this.isInterviewStarted) {
                      console.log('âœ… é¢è¯•å·²å¼€å§‹ï¼Œå¯åŠ¨å®æ—¶å¤šæ¨¡æ€åˆ†æ');
                      setTimeout(() => {
                          try {
                              realtimeAnalyzer.startAnalysis();
                              console.log('ğŸ” å®æ—¶å¤šæ¨¡æ€åˆ†æå·²å¯åŠ¨');
                          } catch (error) {
                              console.error('âŒ å®æ—¶åˆ†æå¯åŠ¨å¤±è´¥:', error);
                          }
                      }, 2000); // å»¶è¿Ÿ2ç§’å¯åŠ¨ï¼Œç¡®ä¿é¢è¯•ç•Œé¢ç¨³å®š
                  } else {
                      console.warn('âš ï¸ é¢è¯•çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•å¯åŠ¨å®æ—¶åˆ†æ', {
                          realtimeAnalyzer: !!realtimeAnalyzer,
                          isInterviewStarted: this.isInterviewStarted
                      });
                  }
              };
              
              console.log('âœ… å®æ—¶åˆ†æå™¨é›†æˆå®Œæˆ');
              return true;
          }
          return false;
      }
      
      // å°è¯•ç«‹å³é›†æˆ
      if (!integrateWithInterviewManager()) {
          // å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨è½®è¯¢æœºåˆ¶
          let attempts = 0;
          const maxAttempts = 10;
          
          const integrationInterval = setInterval(() => {
              attempts++;
              console.log(`ğŸ”„ å°è¯•é›†æˆå®æ—¶åˆ†æå™¨ (${attempts}/${maxAttempts})`);
              
              if (integrateWithInterviewManager() || attempts >= maxAttempts) {
                  clearInterval(integrationInterval);
                  if (attempts >= maxAttempts) {
                      console.error('âŒ å®æ—¶åˆ†æå™¨é›†æˆå¤±è´¥ï¼Œè¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°');
                  }
              }
          }, 500); // æ¯500mså°è¯•ä¸€æ¬¡
      }
      
      // ç›‘å¬é¡µé¢å¸è½½ï¼Œæ¸…ç†èµ„æº
      window.addEventListener('beforeunload', () => {
          if (realtimeAnalyzer) {
              realtimeAnalyzer.destroy();
          }
      });
  });

  // æš´éœ²å…¨å±€æ§åˆ¶æ–¹æ³•
  window.toggleRealtimeAnalysis = () => {
      if (realtimeAnalyzer) {
          realtimeAnalyzer.toggleAnalysis();
      }
  };
  </script>
  </body>
  </html>