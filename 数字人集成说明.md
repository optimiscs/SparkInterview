# 数字人SDK集成说明

## 概述

本项目已成功集成讯飞星火数字人SDK，实现AI面试官的语音播报和视觉呈现功能。数字人能够自动朗读大模型返回的文字，无需手动触发。

## 配置信息

### API配置
- **接口服务ID**: 216904764871544832
- **APPID**: 015076e9
- **APIKey**: 9bcb3472851cf652bd640107f258910a
- **APISecret**: YTM3MzAwZDEzMDgyZjFmNjI0MmFhOTg1
- **数字人形象ID**: 138801001
- **声音**: x4_yuexiaoni_assist (悦小妮助手)

### 功能特性
- ✅ 自动朗读AI回复文字
- ✅ 实时字幕同步显示
- ✅ 录音时自动中断数字人播放避免冲突
- ✅ 支持语音中断和继续
- ✅ 文本清理和优化
- ✅ 错误处理和重连机制

## 文件结构

```
frontend/
├── avatar-sdk-web_3.1.2.1002/          # 数字人SDK
│   ├── index.js                         # SDK主文件
│   ├── index.d.ts                       # TypeScript类型定义
│   └── ...
├── js/
│   ├── avatar-integration-manager.js    # 数字人集成管理器 (新增)
│   ├── avatar-debug-helper.js          # 调试助手 (新增)
│   └── langgraph-interview.js          # 面试系统 (已修改)
└── interview.html                       # 面试页面 (已修改)
```

## 使用方法

### 自动使用
数字人功能会在页面加载时自动初始化，当AI返回回复时会自动开始朗读，无需手动操作。

### 手动控制
在浏览器控制台中可以使用以下命令：

```javascript
// 检查数字人状态
avatarDebug.checkStatus()

// 手动初始化
await avatarDebug.init()

// 测试朗读
await avatarDebug.testSpeak("这是测试语音")

// 停止播放
await avatarDebug.stop()

// 重连服务
await avatarDebug.reconnect()

// 查看帮助
avatarDebug.help()
```

## 工作流程

1. **页面加载** → 自动初始化数字人SDK
2. **连接服务** → 建立与讯飞服务器的连接
3. **AI回复** → LangGraph系统接收AI回复
4. **文本处理** → 清理文本，移除特殊标记
5. **数字人朗读** → 自动播放语音和口型
6. **字幕同步** → 实时显示朗读内容
7. **录音中断** → 用户录音时自动暂停数字人

## 状态指示

在右侧分析面板可以看到数字人状态：
- **准备就绪** - 数字人系统已初始化
- **正在连接** - 正在建立连接
- **已连接** - 连接成功，可以使用
- **正在播放** - 数字人正在朗读
- **播放完毕** - 朗读结束
- **错误** - 出现异常

## 故障排除

### 常见问题

#### 1. 数字人无声音
**检查步骤：**
```javascript
// 检查状态
avatarDebug.checkStatus()

// 测试播放
await avatarDebug.testSpeak()
```

**可能原因：**
- 浏览器音量被静音
- API配置错误
- 网络连接问题

#### 2. 连接失败
**解决方法：**
```javascript
// 重新连接
await avatarDebug.reconnect()

// 如果还是失败，检查网络和API配置
```

#### 3. 口型不同步
**检查：**
- 网络延迟是否过高
- 视频容器是否正确显示

#### 4. 文字不播放
**检查：**
- AI是否真的返回了文字
- 文字是否为空或只包含特殊字符
- 数字人是否正在播放其他内容

### 调试信息

打开浏览器开发者工具 (F12) 查看控制台日志：
- `🤖` 开头的日志 - 数字人相关
- `🎤` 开头的日志 - 语音播放相关
- `❌` 开头的日志 - 错误信息

### 网络要求

- **协议**: WebSocket (wss://)
- **域名**: avatar.cn-huadong-1.xf-yun.com
- **端口**: 443 (HTTPS)
- **防火墙**: 确保不被拦截

## API限制

### 调用频率
- 建议控制在合理范围内
- 避免短时间内大量请求

### 文本长度
- 单次播放建议不超过500字
- 过长文本会自动分段处理

### 并发连接
- 每个APPID限制并发连接数
- 建议复用连接，避免频繁建立

## 扩展开发

### 添加新功能

```javascript
// 获取管理器实例
const manager = window.getAvatarManager();

// 设置事件回调
manager.setEventCallback('onConnected', (info) => {
    console.log('数字人连接成功', info);
});

// 自定义播放参数
await window.speakText('自定义文本', {
    speed: 60,        // 语速
    volume: 90,       // 音量
    pitch: 50,        // 音调
    interruptible: true  // 可中断
});
```

### 配置更新

```javascript
// 更新TTS配置
avatarDebug.updateConfig({
    globalParams: {
        tts: {
            speed: 60,     // 调整语速
            volume: 90,    // 调整音量
            pitch: 55      // 调整音调
        }
    }
});
```

## 版本信息

- **数字人SDK版本**: 3.1.2.1002
- **集成版本**: 1.0.0
- **最后更新**: 2024-01-20

## 联系支持

如果遇到问题：
1. 首先查看控制台错误日志
2. 使用调试命令检查状态
3. 检查网络连接和API配置
4. 联系技术支持团队

---

🎭 **数字人AI面试官为您服务！**
